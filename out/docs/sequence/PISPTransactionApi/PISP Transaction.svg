<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5341px" preserveAspectRatio="none" style="width:5205px;height:5341px;background:#FFFFFF;" version="1.1" viewBox="0 0 5205 5341" width="5205px" zoomAndPan="magnify"><defs><filter height="300%" id="f5i7xtpyqqsk3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="147" x="2525.75" y="28.708">PISP Transaction</text><rect fill="#DDDDDD" height="5294.7813" style="stroke:#A80036;stroke-width:1.0;" width="1084.5" x="481.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="933.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="5294.7813" style="stroke:#A80036;stroke-width:1.0;" width="467.5" x="1568" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191" x="1706.25" y="53.02">PISP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5294.7813" style="stroke:#A80036;stroke-width:1.0;" width="73" x="2037.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="2040.5" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="5294.7813" style="stroke:#A80036;stroke-width:1.0;" width="719.5" x="2512.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197" x="2773.75" y="53.02">DFSP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5294.7813" style="stroke:#A80036;stroke-width:1.0;" width="1127.5" x="3443.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="3914.25" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1880.4375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1880.4375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3024.9297"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3428.1328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4335.7188"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5188.0391"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="2966.6641"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="4238.3203"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="5129.7734"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1634" y="442.2422"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="214.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="2781.7344"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="3532.5313"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4140.9219"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4999.2422"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2573" y="3623.9297"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="3682.1953"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="4784.4453"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3504" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1787.3672" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3769" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3769" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3779" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3779" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1787.3047" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3769" y="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3769" y1="3241.0703" y2="5028.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3779" y1="3241.0703" y2="5028.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3779" y1="5028.375" y2="5028.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1500" x2="1500" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1500" x2="1500" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1639" x2="1639" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1639" x2="1639" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1969.5" x2="1969.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1969.5" x2="1969.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2073.5" x2="2073.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2073.5" x2="2073.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2577.5" x2="2577.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2577.5" x2="2577.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3161" x2="3161" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3161" x2="3161" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3508.5" x2="3508.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3508.5" x2="3508.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3508.5" x2="3508.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3508.5" x2="3508.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3508.5" x2="3508.5" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3774" x2="3774" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3774" x2="3774" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3774" x2="3774" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3774" x2="3774" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3774" x2="3774" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4500" x2="4500" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4500" x2="4500" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4500" x2="4500" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4500" x2="4500" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4500" x2="4500" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4612" x2="4612" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4612" x2="4612" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4612" x2="4612" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4612" x2="4612" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4612" x2="4612" y1="3241.0703" y2="5297.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5164.5" x2="5164.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="5164.5" x2="5164.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5164.5" x2="5164.5" y1="653.7109" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="5164.5" x2="5164.5" y1="3187.4609" y2="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="5164.5" x2="5164.5" y1="3241.0703" y2="5297.4375"/><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="5316.4326">PISP Backend</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="5316.4326">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="80.0811">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="5316.4326">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1439" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1446" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1439" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1446" y="5316.4326">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1572" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1579" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1572" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1579" y="5316.4326">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1908.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1915.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1908.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1915.5" y="5316.4326">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2042.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2049.5" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2042.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2049.5" y="5316.4326">Switch</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="2516.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="2523.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="2516.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="2523.5" y="5316.4326">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3094" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3101" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3094" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3101" y="5316.4326">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3447.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3454.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3447.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3454.5" y="5316.4326">inbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3685" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3692" y="80.0811">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3685" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3692" y="5316.4326">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4433" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4440" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4433" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4440" y="5316.4326">outbound-server</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="4577" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="4584" y="80.0811">activate</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="4577" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="4584" y="5316.4326">activate</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="5135.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5142.5" y="80.0811">Swich</text><rect fill="#FEFECE" filter="url(#f5i7xtpyqqsk3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="5135.5" y="5296.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5142.5" y="5316.4326">Swich</text><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1880.4375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="2140.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1880.4375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3399"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3024.9297"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3428.1328"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4335.7188"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5188.0391"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="2966.6641"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="4238.3203"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="5129.7734"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1634" y="442.2422"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="214.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="2781.7344"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="3532.5313"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4140.9219"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4999.2422"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2573" y="3623.9297"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="3682.1953"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="4784.4453"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3504" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1787.3672" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3769" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3769" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3779" y1="1400.0938" y2="3187.4609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3779" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#f5i7xtpyqqsk3)" height="1787.3047" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3769" y="3241.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3769" y1="3241.0703" y2="5028.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3779" y1="3241.0703" y2="5028.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769" x2="3779" y1="5028.375" y2="5028.375"/><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5198.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="117" x="2540.75" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="2546.75" y="131.4497">Party Lookup</text><rect fill="#ADD8E6" filter="url(#f5i7xtpyqqsk3)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="448" x="79" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="83" y="169.5825">POST /thirdpartyTransaction/partyLookup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="184.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="432" x="91" y="199.8481">transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="91" y="214.981">payee: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="99" y="230.1138">partyIdType: "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="99" y="245.2466">partyIdentifier: "+123456789"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="91" y="260.3794">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="275.5122">}</text><polygon fill="#A80036" points="535.5,304.7109,545.5,308.7109,535.5,312.7109,539.5,308.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="308.7109" y2="308.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="303.645">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="144.5" y="303.645">POST /thirdpartyTransaction/partyLookup</text><polygon fill="#A80036" points="883.5,333.8438,893.5,337.8438,883.5,341.8438,887.5,337.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="337.8438" y2="337.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="332.7778">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="622.5" y="332.7778">partyLookup()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="177" x="910" y="350.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="914" y="366.9106">state: requestPartyLookup</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="400.1094" y2="400.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="400.1094" y2="413.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="413.1094" y2="413.1094"/><polygon fill="#A80036" points="916.5,409.1094,906.5,413.1094,916.5,417.1094,912.5,413.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="395.0435">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="970.5" y="395.0435">SDKRequests.requestPartiesInformation</text><polygon fill="#A80036" points="1622,438.2422,1632,442.2422,1622,446.2422,1626,442.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="1628" y1="442.2422" y2="442.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="437.1763">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="970.5" y="437.1763">SYNC GET /parties/{type}/{id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1644" x2="1686" y1="471.375" y2="471.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1686" x2="1686" y1="471.375" y2="484.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1645" x2="1686" y1="484.375" y2="484.375"/><polygon fill="#A80036" points="1655,480.375,1645,484.375,1655,488.375,1651,484.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1651" y="466.3091">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1709" y="466.3091">retrieve PartiesInformation from Switch</text><polygon fill="#A80036" points="916.5,509.5078,906.5,513.5078,916.5,517.5078,912.5,513.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1638" y1="513.5078" y2="513.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="922.5" y="508.4419">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="980.5" y="508.4419">200 PartyInformation</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="145" x="910" y="526.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="914" y="542.5747">state: payeeResolved</text><polygon fill="#A80036" points="568.5,571.7734,558.5,575.7734,568.5,579.7734,564.5,575.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="575.7734" y2="575.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="574.5" y="570.7075">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="632.5" y="570.7075">partyInformation</text><polygon fill="#A80036" points="85.5,600.9063,75.5,604.9063,85.5,608.9063,81.5,604.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="604.9063" y2="604.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="91.5" y="599.8403">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="149.5" y="599.8403">200 OK PartyInformation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="379" x="2430" y="637.1167">User checks the party name, and confirms transaction to continue</text><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5198.5" x="0" y="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="674.2773" y2="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="677.2773" y2="677.2773"/><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="156" x="2521.25" y="663.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137" x="2527.25" y="679.7778">Initate Transaction</text><rect fill="#ADD8E6" filter="url(#f5i7xtpyqqsk3)" height="310" style="stroke:#A80036;stroke-width:1.0;" width="395" x="79" y="701.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="83" y="717.9106">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="733.0435">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="91" y="748.1763">amount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="99" y="763.3091">amount: "20.00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="99" y="778.4419">currency: "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="793.5747">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="91" y="808.7075">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="91" y="823.8403">"payee": {....},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="91" y="838.9731">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="99" y="854.106">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="99" y="869.2388">"partyIdentifier": "qwerty-56789",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="99" y="884.3716">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="899.5044">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="91" y="914.6372">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="99" y="929.77">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="99" y="944.9028">"initiator": 'PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="99" y="960.0356">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="975.1685">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="91" y="990.3013">expiration: "2021-03-08T08:08:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="1005.4341">}</text><polygon fill="#A80036" points="535.5,1034.6328,545.5,1038.6328,535.5,1042.6328,539.5,1038.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="1038.6328" y2="1038.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="86.5" y="1033.5669">INIT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="131.5" y="1033.5669">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><polygon fill="#A80036" points="883.5,1063.7656,893.5,1067.7656,883.5,1071.7656,887.5,1067.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="1067.7656" y2="1067.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="564.5" y="1062.6997">INIT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="609.5" y="1062.6997">initiate()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="236" x="910" y="1080.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="914" y="1096.8325">state: requestThirdpartyTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="1130.0313" y2="1130.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="1130.0313" y2="1143.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="1143.0313" y2="1143.0313"/><polygon fill="#A80036" points="916.5,1139.0313,906.5,1143.0313,916.5,1147.0313,912.5,1143.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1124.9653">INIT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="957.5" y="1124.9653">SDKRequests.requestThirdpartyTransaction()</text><polygon fill="#A80036" points="2057,1168.1641,2067,1172.1641,2057,1176.1641,2061,1172.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2063" y1="1172.1641" y2="1172.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1167.0981">INIT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="957.5" y="1167.0981">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="911.5,1197.2969,901.5,1201.2969,911.5,1205.2969,907.5,1201.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2068" y1="1201.2969" y2="1201.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="917.5" y="1196.231">INIT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="962.5" y="1196.231">202 Accepted</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="905" y="1214.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="909" y="1230.3638">state: pendingTransactionInitiation</text><path d="M3372,1247.4297 L3372,1272.4297 L3642,1272.4297 L3642,1257.4297 L3632,1247.4297 L3372,1247.4297 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3632,1247.4297 L3632,1257.4297 L3642,1257.4297 L3632,1247.4297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="3378" y="1264.4966">DFSP handles PISP transaction request</text><polygon fill="#A80036" points="3492,1298.6953,3502,1302.6953,3492,1306.6953,3496,1302.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="3498" y1="1302.6953" y2="1302.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2086" y="1297.6294">INIT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="2131" y="1297.6294">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="2085,1327.8281,2075,1331.8281,2085,1335.8281,2081,1331.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3503" y1="1331.8281" y2="1331.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2091" y="1326.7622">INIT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2136" y="1326.7622">202 Accepted</text><path d="M3610,1344.8281 L3610,1369.8281 L3934,1369.8281 L3934,1354.8281 L3924,1344.8281 L3610,1344.8281 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3924,1344.8281 L3924,1354.8281 L3934,1354.8281 L3924,1344.8281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="3616" y="1361.895">DFSP starts workflow for DFSPTransactionModel</text><polygon fill="#A80036" points="3757,1396.0938,3767,1400.0938,3757,1404.0938,3761,1400.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3509" x2="3763" y1="1400.0938" y2="1400.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="3516" y="1395.0278">INIT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3561" y="1395.0278">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="281" x="3784" y="1413.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="3788" y="1429.1606">state: transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3788" y="1444.2935">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="3975" y="1444.2935">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="3989" y="1444.2935">RECEIVED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="1477.4922" y2="1477.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="1477.4922" y2="1490.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="1490.4922" y2="1490.4922"/><polygon fill="#A80036" points="3790,1486.4922,3780,1490.4922,3790,1494.4922,3786,1490.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="3786" y="1472.4263">INIT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3831" y="1472.4263">persist transactionRequestState for transactionRequestId</text><path d="M3531,1503.4922 L3531,1528.4922 L4012,1528.4922 L4012,1513.4922 L4002,1503.4922 L3531,1503.4922 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4002,1503.4922 L4002,1513.4922 L4012,1513.4922 L4002,1503.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="3537" y="1520.5591">DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="1558.7578" y2="1558.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="1558.7578" y2="1571.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="1571.7578" y2="1571.7578"/><polygon fill="#A80036" points="3790,1567.7578,3780,1571.7578,3790,1575.7578,3786,1571.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="1553.6919">INIT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="624" x="3840" y="1553.6919">DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)</text><path d="M3673,1584.7578 L3673,1609.7578 L3871,1609.7578 L3871,1594.7578 L3861,1584.7578 L3673,1584.7578 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3861,1584.7578 L3861,1594.7578 L3871,1594.7578 L3861,1584.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="3679" y="1601.8247">DFSP is happy with Consent</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="141" x="3784" y="1623.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="3788" y="1639.9575">state: consentIsValid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="1673.1563" y2="1673.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="1673.1563" y2="1686.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="1686.1563" y2="1686.1563"/><polygon fill="#A80036" points="3790,1682.1563,3780,1686.1563,3790,1690.1563,3786,1686.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="1668.0903">INIT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="3840" y="1668.0903">so generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="3921" y="1668.0903">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="4018" y="1668.0903">: '1234-1234-1234-1234'</text><path d="M3574,1699.1563 L3574,1724.1563 L3969,1724.1563 L3969,1709.1563 L3959,1699.1563 L3574,1699.1563 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3959,1699.1563 L3959,1709.1563 L3969,1709.1563 L3959,1699.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="3580" y="1716.2231">DFSP informs PISP that</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="3732" y="1716.2231">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3833" y="1716.2231">has been allocated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="1754.4219" y2="1754.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="1754.4219" y2="1767.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="1767.4219" y2="1767.4219"/><polygon fill="#A80036" points="3790,1763.4219,3780,1767.4219,3790,1771.4219,3786,1767.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="1749.356">INIT-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="648" x="3840" y="1749.356">SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="400" x="3784" y="1780.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="3788" y="1796.4888">state: pendingNotifyThirdpartyAboutTransactionRequestState</text><rect fill="#ADD8E6" filter="url(#f5i7xtpyqqsk3)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="393" x="3784" y="1813.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="3788" y="1829.6216">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3788" y="1844.7544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="3796" y="1859.8872">transactionId: '1234-1234-1234-1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="3796" y="1875.02">transactionRequestState: 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3788" y="1890.1528">}</text><polygon fill="#A80036" points="2090,1919.3516,2080,1923.3516,2090,1927.3516,2086,1923.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3768" y1="1923.3516" y2="1923.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2096" y="1918.2856">INIT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="2150" y="1918.2856">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="3757,1948.4844,3767,1952.4844,3757,1956.4844,3761,1952.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3763" y1="1952.4844" y2="1952.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2086" y="1947.4185">INIT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2140" y="1947.4185">202 Accepted</text><polygon fill="#A80036" points="1516.5,1977.6172,1506.5,1981.6172,1516.5,1985.6172,1512.5,1981.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="1981.6172" y2="1981.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1522.5" y="1976.5513">INIT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="1576.5" y="1976.5513">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="2062,2006.75,2072,2010.75,2062,2014.75,2066,2010.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="2010.75" y2="2010.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1512.5" y="2005.6841">INIT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="1566.5" y="2005.6841">202 accepted</text><polygon fill="#A80036" points="916.5,2035.8828,906.5,2039.8828,916.5,2043.8828,912.5,2039.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1494.5" y1="2039.8828" y2="2039.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="2034.8169">INIT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="976.5" y="2034.8169">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="230" x="910" y="2052.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="914" y="2068.9497">state: transactionRequestReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="2107.1484" y2="2107.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="2107.1484" y2="2120.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900.5" x2="947.5" y1="2120.1484" y2="2120.1484"/><polygon fill="#A80036" points="910.5,2116.1484,900.5,2120.1484,910.5,2124.1484,906.5,2120.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="912.5" y="2102.0825">INIT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="966.5" y="2102.0825">store received</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="1061.5" y="2102.0825">transactionId</text><path d="M644,2128.1484 L644,2364.1484 L1153,2364.1484 L1153,2138.1484 L1143,2128.1484 L644,2128.1484 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1143,2128.1484 L1143,2138.1484 L1153,2138.1484 L1143,2128.1484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="650" y="2145.2153">There could be a race condition (time based hazard)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="650" y="2160.3481">between two incoming calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2175.481"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="306" x="650" y="2190.6138">PUT /thirdpartyReqeusts/transaction/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="650" y="2205.7466">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301" x="650" y="2220.8794">POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2236.0122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="650" y="2251.145">so we are mitigating it by alternative two-step transitions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2266.2778"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="650" y="2281.4106">pendingTransactionInitiation (START):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2296.5435">-&gt; (CASE-1) transactionRequestReceived -&gt; authorizationRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2311.6763">-&gt; (CASE-2) authorizationRequestReceived -&gt; transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="650" y="2326.8091">-&gt; transactionInitiationSuccess (END)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2341.9419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="650" y="2357.0747">CASE-1 is visualised here</text><path d="M3658,2379.1406 L3658,2404.1406 L3885,2404.1406 L3885,2389.1406 L3875,2379.1406 L3658,2379.1406 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3875,2379.1406 L3875,2389.1406 L3885,2389.1406 L3875,2379.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="3664" y="2396.2075">DFSP requires QuoteInformation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="2434.4063" y2="2434.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="2434.4063" y2="2447.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="2447.4063" y2="2447.4063"/><polygon fill="#A80036" points="3790,2443.4063,3780,2447.4063,3790,2451.4063,3786,2447.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="2429.3403">INIT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="3840" y="2429.3403">SDKRequests.requestQuote()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="191" x="3784" y="2460.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="3788" y="2476.4731">state: pendingRequestQuote</text><polygon fill="#A80036" points="3177,2505.6719,3167,2509.6719,3177,2513.6719,3173,2509.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3171" x2="3768" y1="2509.6719" y2="2509.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3183" y="2504.606">INIT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="3237" y="2504.606">SYNC POST /quotes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3166" x2="3208" y1="2538.8047" y2="2538.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3208" x2="3208" y1="2538.8047" y2="2551.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3167" x2="3208" y1="2551.8047" y2="2551.8047"/><polygon fill="#A80036" points="3177,2547.8047,3167,2551.8047,3177,2555.8047,3173,2551.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3173" y="2533.7388">INIT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="3227" y="2533.7388">retrieve QuoteInformation from Switch</text><polygon fill="#A80036" points="3757,2576.9375,3767,2580.9375,3757,2584.9375,3761,2580.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3763" y1="2580.9375" y2="2580.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3168" y="2575.8716">INIT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="3222" y="2575.8716">200 QuoteInformation</text><path d="M3518,2593.9375 L3518,2618.9375 L4025,2618.9375 L4025,2603.9375 L4015,2593.9375 L3518,2593.9375 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4015,2593.9375 L4015,2603.9375 L4025,2603.9375 L4015,2593.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="486" x="3524" y="2611.0044">DFSP has the QuoteInformation, they can now ask the PISP for authorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="2649.2031" y2="2649.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="2649.2031" y2="2662.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="2662.2031" y2="2662.2031"/><polygon fill="#A80036" points="3790,2658.2031,3780,2662.2031,3790,2666.2031,3786,2662.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="2644.1372">INIT-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="3840" y="2644.1372">SDKRequests.requestAuthorization()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="276" x="3784" y="2675.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="3788" y="2691.27">state: pendingRequestAuthorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3788" y="2706.4028">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="3975" y="2706.4028">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="3989" y="2706.4028">PENDING</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="2739.6016" y2="2739.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="2739.6016" y2="2752.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="2752.6016" y2="2752.6016"/><polygon fill="#A80036" points="3790,2748.6016,3780,2752.6016,3790,2756.6016,3786,2752.6016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3786" y="2734.5356">INIT-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3840" y="2734.5356">persist transactionRequestState for transactionRequestId</text><polygon fill="#A80036" points="2090,2777.7344,2080,2781.7344,2090,2785.7344,2086,2781.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3768" y1="2781.7344" y2="2781.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2096" y="2776.6685">INIT-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="2150" y="2776.6685">POST /thirdpartyRequests/authorizations</text><path d="M3559,2794.7344 L3559,2864.7344 L3985,2864.7344 L3985,2804.7344 L3975,2794.7344 L3559,2794.7344 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3975,2794.7344 L3975,2804.7344 L3985,2804.7344 L3975,2794.7344 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="3565" y="2811.8013">From now DFSPTransactionModel is blocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="3565" y="2826.9341">on synchronous call to POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="3565" y="2842.0669">until PISP initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="3675" y="2842.0669">Approve Transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="3831" y="2842.0669">phase.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="3565" y="2857.1997">Here timeout scenario should be handled properly</text><polygon fill="#A80036" points="3757,2891.3984,3767,2895.3984,3757,2899.3984,3761,2895.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3763" y1="2895.3984" y2="2895.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2086" y="2890.3325">INIT-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2140" y="2890.3325">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="4612.5" x2="4654.5" y1="2929.5313" y2="2929.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4654.5" x2="4654.5" y1="2929.5313" y2="2942.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4607.5" x2="4654.5" y1="2942.5313" y2="2942.5313"/><polygon fill="#A80036" points="4617.5,2938.5313,4607.5,2942.5313,4617.5,2946.5313,4613.5,2942.5313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4619.5" y="2924.4653">INIT-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="4673.5" y="2924.4653">waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="1516.5,2962.6641,1506.5,2966.6641,1516.5,2970.6641,1512.5,2966.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="2966.6641" y2="2966.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1522.5" y="2961.5981">INIT-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="1576.5" y="2961.5981">POST /thirdpartyRequests/authorizations</text><polygon fill="#A80036" points="2062,2991.7969,2072,2995.7969,2062,2999.7969,2066,2995.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="2995.7969" y2="2995.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1512.5" y="2990.731">INIT-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1566.5" y="2990.731">200 OK</text><polygon fill="#A80036" points="916.5,3020.9297,906.5,3024.9297,916.5,3028.9297,912.5,3024.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1494.5" y1="3024.9297" y2="3024.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="3019.8638">INIT-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="976.5" y="3019.8638">authorizationRequestReceived()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="242" x="910" y="3067.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="914" y="3083.9966">state: authorizationRequestReceived</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="910" y="3101.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="914" y="3117.1294">state: transactionInitiationSuccess</text><polygon fill="#A80036" points="568.5,3146.3281,558.5,3150.3281,568.5,3154.3281,564.5,3150.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="3150.3281" y2="3150.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="574.5" y="3145.2622">INIT-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="628.5" y="3145.2622">QuoteInformation, transactionId</text><polygon fill="#A80036" points="85.5,3175.4609,75.5,3179.4609,85.5,3183.4609,81.5,3179.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="3179.4609" y2="3179.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="91.5" y="3174.395">INIT-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="145.5" y="3174.395">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="2534.5" y="3211.6714">Present quote to be approved</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2548.5" y="3224.4761">User signs the challenge</text><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="5198.5" x="0" y="3261.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="3261.6367" y2="3261.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="5198.5" y1="3264.6367" y2="3264.6367"/><rect fill="#EEEEEE" filter="url(#f5i7xtpyqqsk3)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="171" x="2513.75" y="3251.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="2519.75" y="3267.1372">Approve Transaction</text><rect fill="#ADD8E6" filter="url(#f5i7xtpyqqsk3)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="404" x="79" y="3289.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="83" y="3305.27">rnote right of PISP #Light</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="83" y="3320.4028">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3335.5356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="91" y="3350.6685">signedChallenge: "base64(xxx)"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3365.8013">}</text><polygon fill="#A80036" points="535.5,3395,545.5,3399,535.5,3403,539.5,3399" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="3399" y2="3399"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="3393.9341">APPR-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="144.5" y="3393.9341">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><polygon fill="#A80036" points="883.5,3424.1328,893.5,3428.1328,883.5,3432.1328,887.5,3428.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="3428.1328" y2="3428.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="3423.0669">APPR-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="622.5" y="3423.0669">approve()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="161" x="910" y="3441.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="914" y="3457.1997">state: approvalReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="3490.3984" y2="3490.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="3490.3984" y2="3503.3984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="3503.3984" y2="3503.3984"/><polygon fill="#A80036" points="916.5,3499.3984,906.5,3503.3984,916.5,3507.3984,912.5,3503.3984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3485.3325">APPR-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="518" x="970.5" y="3485.3325">SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)</text><polygon fill="#A80036" points="2057,3528.5313,2067,3532.5313,2057,3536.5313,2061,3532.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2063" y1="3532.5313" y2="3532.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3527.4653">APPR-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="970.5" y="3527.4653">PUT /authorizations/{transactionRequestId}</text><polygon fill="#A80036" points="911.5,3557.6641,901.5,3561.6641,911.5,3565.6641,907.5,3561.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2068" y1="3561.6641" y2="3561.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="917.5" y="3556.5981">APPR-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="975.5" y="3556.5981">202 Accepted</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="905" y="3574.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="909" y="3590.731">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="2561,3619.9297,2571,3623.9297,2561,3627.9297,2565,3623.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="2567" y1="3623.9297" y2="3623.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2086" y="3618.8638">APPR-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="2144" y="3618.8638">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="2085,3649.0625,2075,3653.0625,2085,3657.0625,2081,3653.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="2572" y1="3653.0625" y2="3653.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2091" y="3647.9966">APPR-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2149" y="3647.9966">202 Accepted</text><polygon fill="#A80036" points="3144,3678.1953,3154,3682.1953,3144,3686.1953,3148,3682.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2583" x2="3150" y1="3682.1953" y2="3682.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2590" y="3677.1294">APPR-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="496" x="2648" y="3677.1294">notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="3757,3707.3281,3767,3711.3281,3757,3715.3281,3761,3711.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3763" y1="3711.3281" y2="3711.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="3168" y="3706.2622">APPR-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="3226" y="3706.2622">200: AuthorizationInformation</text><path d="M3614,3724.3281 L3614,3749.3281 L3930,3749.3281 L3930,3734.3281 L3920,3724.3281 L3614,3724.3281 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3920,3724.3281 L3920,3734.3281 L3930,3734.3281 L3920,3724.3281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="3620" y="3741.395">From now DFSPTransactionModel is unblocked</text><path d="M3488,3763.4609 L3488,3788.4609 L4055,3788.4609 L4055,3773.4609 L4045,3763.4609 L3488,3763.4609 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4045,3763.4609 L4045,3773.4609 L4055,3773.4609 L4045,3763.4609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="3494" y="3780.5278">TransactionModel checks the received AuthorizationInformation with the auth-service.</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="3784" y="3802.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="3788" y="3818.6606">state: pendingVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="3851.8594" y2="3851.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="3851.8594" y2="3864.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="3864.8594" y2="3864.8594"/><polygon fill="#A80036" points="3790,3860.8594,3780,3864.8594,3790,3868.8594,3786,3864.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="3846.7935">APPR-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="3853" y="3846.7935">generate verificationRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="3893.9922" y2="3893.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="3893.9922" y2="3906.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="3906.9922" y2="3906.9922"/><polygon fill="#A80036" points="3790,3902.9922,3780,3906.9922,3790,3910.9922,3786,3906.9922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="3888.9263">APPR-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="439" x="3853" y="3888.9263">DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)</text><path d="M5,3919.9922 L5,3944.9922 L3845,3944.9922 L3845,3929.9922 L3835,3919.9922 L5,3919.9922 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3835,3919.9922 L3835,3929.9922 L3845,3929.9922 L3835,3919.9922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="609" x="1614" y="3937.0591">ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="279" x="3784" y="3959.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="3788" y="3975.1919">DFSP is unhappy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3788" y="3990.3247">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="3975" y="3990.3247">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="3989" y="3990.3247">REJECTED</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="209" x="3784" y="4007.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3788" y="4023.4575">state: failureVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4056.6563" y2="4056.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4056.6563" y2="4069.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4069.6563" y2="4069.6563"/><polygon fill="#A80036" points="3790,4065.6563,3780,4069.6563,3790,4073.6563,3786,4069.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4051.5903">APPR-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3853" y="4051.5903">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4098.7891" y2="4098.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4098.7891" y2="4111.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4111.7891" y2="4111.7891"/><polygon fill="#A80036" points="3790,4107.7891,3780,4111.7891,3790,4115.7891,3786,4111.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4093.7231">APPR-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="512" x="3853" y="4093.7231">SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)</text><polygon fill="#A80036" points="2090,4136.9219,2080,4140.9219,2090,4144.9219,2086,4140.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3768" y1="4140.9219" y2="4140.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2096" y="4135.856">APPR-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="2163" y="4135.856">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="3757,4166.0547,3767,4170.0547,3757,4174.0547,3761,4170.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="3763" y1="4170.0547" y2="4170.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2086" y="4164.9888">APPR-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="2153" y="4164.9888">202 Accept</text><path d="M3528,4183.0547 L3528,4208.0547 L4015,4208.0547 L4015,4193.0547 L4005,4183.0547 L3528,4183.0547 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4005,4183.0547 L4005,4193.0547 L4015,4193.0547 L4005,4183.0547 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="3534" y="4200.1216">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="343" x="3657" y="4200.1216">DFSPTransactionModel ends its workflow here</text><polygon fill="#A80036" points="1516.5,4234.3203,1506.5,4238.3203,1516.5,4242.3203,1512.5,4238.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="5163.5" y1="4238.3203" y2="4238.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1522.5" y="4233.2544">APPR-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="1589.5" y="4233.2544">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="2062,4263.4531,2072,4267.4531,2062,4271.4531,2066,4267.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1505.5" x2="2068" y1="4267.4531" y2="4267.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1512.5" y="4262.3872">APPR-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="1579.5" y="4262.3872">202 Accept</text><path d="M647,4280.4531 L647,4305.4531 L1149,4305.4531 L1149,4290.4531 L1139,4280.4531 L647,4280.4531 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1139,4280.4531 L1139,4290.4531 L1149,4290.4531 L1139,4280.4531 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="653" y="4297.52">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="358" x="776" y="4297.52">PISPTransactionModel will end its workflow here</text><polygon fill="#A80036" points="916.5,4331.7188,906.5,4335.7188,916.5,4339.7188,912.5,4335.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1499.5" y1="4335.7188" y2="4335.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="4330.6528">APPR-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="989.5" y="4330.6528">authorizationRejected()</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="186" x="910" y="4348.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="914" y="4364.7856">state: rejectedAuthorization</text><polygon fill="#A80036" points="568.5,4393.9844,558.5,4397.9844,568.5,4401.9844,564.5,4397.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="4397.9844" y2="4397.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="4392.9185">APPR-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="641.5" y="4392.9185">not approved: authorization is rejected</text><polygon fill="#A80036" points="90.5,4423.1172,80.5,4427.1172,90.5,4431.1172,86.5,4427.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="84.5" x2="546.5" y1="4427.1172" y2="4427.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="96.5" y="4422.0513">APPR-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="163.5" y="4422.0513">500: authorization is rejected</text><path d="M5,4440.1172 L5,4465.1172 L3845,4465.1172 L3845,4450.1172 L3835,4440.1172 L5,4440.1172 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3835,4440.1172 L3835,4450.1172 L3845,4450.1172 L3835,4440.1172 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="1698.5" y="4457.1841">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="317" x="1821.5" y="4457.1841">DFSPTransactionModel continues workflow</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="286" x="3784" y="4479.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="3788" y="4495.3169">DFSP is happy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="3788" y="4510.4497">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="3975" y="4510.4497">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="3989" y="4510.4497">ACCEPTED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4543.6484" y2="4543.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4543.6484" y2="4556.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4556.6484" y2="4556.6484"/><polygon fill="#A80036" points="3790,4552.6484,3780,4556.6484,3790,4560.6484,3786,4556.6484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4538.5825">APPR-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="3853" y="4538.5825">persist transactionRequestState for transactionRequestId</text><path d="M3594,4569.6484 L3594,4594.6484 L3950,4594.6484 L3950,4579.6484 L3940,4569.6484 L3594,4569.6484 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3940,4569.6484 L3940,4579.6484 L3950,4579.6484 L3940,4569.6484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="3600" y="4586.7153">DFSP is happy, so initiates the Transfer for transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4624.9141" y2="4624.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4624.9141" y2="4637.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4637.9141" y2="4637.9141"/><polygon fill="#A80036" points="3790,4633.9141,3780,4637.9141,3790,4641.9141,3786,4637.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4619.8481">APPR-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="3853" y="4619.8481">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="73" x="3915" y="4619.8481">transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4667.0469" y2="4667.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4667.0469" y2="4680.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4680.0469" y2="4680.0469"/><polygon fill="#A80036" points="3790,4676.0469,3780,4680.0469,3790,4684.0469,3786,4680.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4661.981">APPR-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3853" y="4661.981">transfer(transferId)</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="152" x="3784" y="4693.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3788" y="4709.1138">state: pendingTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4742.3125" y2="4742.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4742.3125" y2="4755.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4755.3125" y2="4755.3125"/><polygon fill="#A80036" points="3790,4751.3125,3780,4755.3125,3790,4759.3125,3786,4755.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4737.2466">APPR-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="3853" y="4737.2466">SDKRequests.requestTransfer(transferId, transferPayload)</text><polygon fill="#A80036" points="3177,4780.4453,3167,4784.4453,3177,4788.4453,3173,4784.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3171" x2="3768" y1="4784.4453" y2="4784.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3183" y="4779.3794">APPR-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3250" y="4779.3794">SYNC POST /simpleTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3166" x2="3208" y1="4813.5781" y2="4813.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3208" x2="3208" y1="4813.5781" y2="4826.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3167" x2="3208" y1="4826.5781" y2="4826.5781"/><polygon fill="#A80036" points="3177,4822.5781,3167,4826.5781,3177,4830.5781,3173,4826.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3173" y="4808.5122">APPR-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="3240" y="4808.5122">request Switch to realize simple transfer</text><polygon fill="#A80036" points="3757,4851.7109,3767,4855.7109,3757,4859.7109,3761,4855.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3763" y1="4855.7109" y2="4855.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3168" y="4850.645">APPR-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="3235" y="4850.645">202: Transfer done</text><path d="M3635,4868.7109 L3635,4893.7109 L3908,4893.7109 L3908,4878.7109 L3898,4868.7109 L3635,4868.7109 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3898,4868.7109 L3898,4878.7109 L3908,4878.7109 L3898,4868.7109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="3641" y="4885.7778">DFSP notifies PISP that Transfer is done</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3779" x2="3821" y1="4923.9766" y2="4923.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3821" x2="3821" y1="4923.9766" y2="4936.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3780" x2="3821" y1="4936.9766" y2="4936.9766"/><polygon fill="#A80036" points="3790,4932.9766,3780,4936.9766,3790,4940.9766,3786,4936.9766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3786" y="4918.9106">APPR-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="3853" y="4918.9106">SDKRequests.notifyThirdpartyAboutTransfer(transferId)</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="291" x="3784" y="4949.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="3788" y="4966.0435">state: pendingNotifyThirdpartyAboutTransfer</text><polygon fill="#A80036" points="2090,4995.2422,2080,4999.2422,2090,5003.2422,2086,4999.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3768" y1="4999.2422" y2="4999.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2096" y="4994.1763">APPR-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="2163" y="4994.1763">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="3762,5024.375,3772,5028.375,3762,5032.375,3766,5028.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3768" y1="5028.375" y2="5028.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2086" y="5023.3091">APPR-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2153" y="5023.3091">202 Accepted</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="226" x="3779" y="5041.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="3783" y="5057.4419">state: transactionRequestSuccess</text><path d="M671,5074.5078 L671,5099.5078 L1126,5099.5078 L1126,5084.5078 L1116,5074.5078 L671,5074.5078 " fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1116,5074.5078 L1116,5084.5078 L1126,5084.5078 L1116,5074.5078 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="677" y="5091.5747">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="800" y="5091.5747">PISPTransactionModel continues workflow</text><polygon fill="#A80036" points="1516.5,5125.7734,1506.5,5129.7734,1516.5,5133.7734,1512.5,5129.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="5129.7734" y2="5129.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1522.5" y="5124.7075">APPR-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="1589.5" y="5124.7075">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="2062,5154.9063,2072,5158.9063,2062,5162.9063,2066,5158.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="5158.9063" y2="5158.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1512.5" y="5153.8403">APPR-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1579.5" y="5153.8403">200 OK</text><polygon fill="#A80036" points="916.5,5184.0391,906.5,5188.0391,916.5,5192.0391,912.5,5188.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1499.5" y1="5188.0391" y2="5188.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="5182.9731">APPR-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="989.5" y="5182.9731">transactionSuccess(transactionRequestId)</text><rect fill="#FBFB77" filter="url(#f5i7xtpyqqsk3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="174" x="910" y="5201.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="914" y="5217.106">state: transactionSuccess</text><polygon fill="#A80036" points="568.5,5246.3047,558.5,5250.3047,568.5,5254.3047,564.5,5250.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="5250.3047" y2="5250.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="5245.2388">APPR-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="641.5" y="5245.2388">Transaction &amp; Transfer are done</text><polygon fill="#A80036" points="85.5,5275.4375,75.5,5279.4375,85.5,5283.4375,81.5,5279.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="5279.4375" y2="5279.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="91.5" y="5274.3716">APPR-35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="158.5" y="5274.3716">200 OK</text><!--MD5=[e29062d0d8f5180587be430e52989b58]
@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
' TODO: line up with state-models.md doc
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

' TODO: party lookup details
PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

'TODO: add authorization details
PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: generate verificationRequestId

DFSP_TM -> DFSP_TM: DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: generate verificationRequestId

DFSP_TM -> DFSP_TM: DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.7(Sun May 23 22:10:07 ACST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>