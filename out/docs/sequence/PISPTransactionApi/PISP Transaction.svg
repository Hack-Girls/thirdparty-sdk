<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5622px" preserveAspectRatio="none" style="width:4937px;height:5622px;background:#FFFFFF;" version="1.1" viewBox="0 0 4937 5622" width="4937px" zoomAndPan="magnify"><defs><filter height="300%" id="fkklqx7xxkbhj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="142" x="2394" y="29.4023">PISP Transaction</text><rect fill="#DDDDDD" height="5574.9141" style="stroke:#A80036;stroke-width:1.0;" width="1070" x="471.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166" x="923.5" y="53.7676">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="5574.9141" style="stroke:#A80036;stroke-width:1.0;" width="469" x="1543.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="176" x="1690" y="53.7676">PISP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5574.9141" style="stroke:#A80036;stroke-width:1.0;" width="70" x="2014.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2019" y="53.7676">Mojaloop</text><rect fill="#DDDDDD" height="5574.9141" style="stroke:#A80036;stroke-width:1.0;" width="280" x="2546.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181" x="2596" y="53.7676">DFSP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5574.9141" style="stroke:#A80036;stroke-width:1.0;" width="1272" x="3029.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171" x="3580" y="53.7676">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="311.1035"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2153.9805" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="1046.6855"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2137.875" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="3421.75"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="311.1035"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2153.9805" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="1046.6855"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2137.875" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="3421.75"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="239.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="340.4141"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="1075.9961"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="68.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="2053.623"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="125.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3045.4238"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3451.0605"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="4522.998"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="5467.6934"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="1995.002"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="88.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="2986.8027"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="4425.0664"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="5409.0723"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1610.5" y="445.3457"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="1180.9277"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="1936.3809"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="215.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="2800.6289"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="121.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="3555.9922"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="169.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="3932.4082"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="4327.1348"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="4614.9297"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="5277.8301"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2749.5" y="2527.1445"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2749.5" y="5061.9668"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3091.5" y="1312.1699"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="1920.7012" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3091.5" y="3647.9238"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="1798.5645" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3511.5" y="1410.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3511.5" y1="1410.1016" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3521.5" y1="1410.1016" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3521.5" y1="1410.1016" y2="1410.1016"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2044.5645" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3511.5" y="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3511.5" y1="3262.5762" y2="5307.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3521.5" y1="3262.5762" y2="5307.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3521.5" y1="5307.1406" y2="5307.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="72" x2="72" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="72" x2="72" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="543.5" x2="543.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="543.5" x2="543.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="886" x2="886" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="886" x2="886" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1474.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1474.5" x2="1474.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1474.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1474.5" x2="1474.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1474.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1615.5" x2="1615.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1615.5" x2="1615.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1615.5" x2="1615.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1615.5" x2="1615.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1615.5" x2="1615.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1945.5" x2="1945.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1945.5" x2="1945.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1945.5" x2="1945.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1945.5" x2="1945.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1945.5" x2="1945.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2049.5" x2="2049.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2049.5" x2="2049.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2049.5" x2="2049.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2049.5" x2="2049.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2049.5" x2="2049.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2613.5" x2="2613.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2613.5" x2="2613.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2613.5" x2="2613.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2613.5" x2="2613.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2613.5" x2="2613.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2754.5" x2="2754.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2754.5" x2="2754.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2754.5" x2="2754.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2754.5" x2="2754.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2754.5" x2="2754.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3096.5" x2="3096.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3096.5" x2="3096.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3096.5" x2="3096.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3096.5" x2="3096.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3096.5" x2="3096.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3516" x2="3516" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3516" x2="3516" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3516" x2="3516" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3516" x2="3516" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3516" x2="3516" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4229.5" x2="4229.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4229.5" x2="4229.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4229.5" x2="4229.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4229.5" x2="4229.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4229.5" x2="4229.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4342.5" x2="4342.5" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4342.5" x2="4342.5" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4342.5" x2="4342.5" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4342.5" x2="4342.5" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4342.5" x2="4342.5" y1="3262.5762" y2="5577.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4896" x2="4896" y1="95.998" y2="616.8984"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4896" x2="4896" y1="616.8984" y2="657.8535"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4896" x2="4896" y1="657.8535" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4896" x2="4896" y1="3208.666" y2="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4896" x2="4896" y1="3262.5762" y2="5577.625"/><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="19" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="26" y="81.0449">PISP Backend</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="19" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="26" y="5597.1602">PISP Backend</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="475.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="482.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="475.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="482.5" y="5597.1602">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="165" x="802" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="809" y="81.0449">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="165" x="802" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="809" y="5597.1602">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1411.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1418.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1411.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1418.5" y="5597.1602">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1547.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1554.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1547.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1554.5" y="5597.1602">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1882.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1889.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1882.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1889.5" y="5597.1602">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="58" x="2018.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="2025.5" y="81.0449">Switch</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="58" x="2018.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="2025.5" y="5597.1602">Switch</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="2550.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2557.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="2550.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2557.5" y="5597.1602">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="2686.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="2693.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="2686.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="2693.5" y="5597.1602">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="3033.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="3040.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="3033.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="3040.5" y="5597.1602">inbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="3429" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="3436" y="81.0449">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="3429" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="3436" y="5597.1602">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="4161.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="4168.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="4161.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="4168.5" y="5597.1602">outbound-server</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="4307.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="4314.5" y="81.0449">activate</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="4307.5" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="4314.5" y="5597.1602">activate</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="4868" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="4875" y="81.0449">Swich</text><rect fill="#FEFECE" filter="url(#fkklqx7xxkbhj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="4868" y="5576.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="4875" y="5597.1602">Swich</text><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="311.1035"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2153.9805" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="1046.6855"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2137.875" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="3421.75"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="311.1035"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2153.9805" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="1046.6855"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2137.875" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="3421.75"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="239.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="340.4141"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="1075.9961"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="68.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="2053.623"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="125.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3045.4238"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3451.0605"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="4522.998"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="5467.6934"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="1995.002"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="88.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="2986.8027"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="4425.0664"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1469.5" y="5409.0723"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1610.5" y="445.3457"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="1180.9277"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="1936.3809"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="215.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="2800.6289"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="121.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="3555.9922"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="169.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="3932.4082"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="4327.1348"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="4614.9297"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2044.5" y="5277.8301"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2749.5" y="2527.1445"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2749.5" y="5061.9668"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3091.5" y="1312.1699"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="1920.7012" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3091.5" y="3647.9238"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="1798.5645" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3511.5" y="1410.1016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3511.5" y1="1410.1016" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3521.5" y1="1410.1016" y2="3208.666"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3521.5" y1="1410.1016" y2="1410.1016"/><rect fill="#FFFFFF" filter="url(#fkklqx7xxkbhj)" height="2044.5645" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3511.5" y="3262.5762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3511.5" y1="3262.5762" y2="5307.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3521.5" y1="3262.5762" y2="5307.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3511.5" x2="3521.5" y1="5307.1406" y2="5307.1406"/><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4930" x="0" y="126.6533"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="126.6533" y2="126.6533"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="129.6533" y2="129.6533"/><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="107" x="2411.5" y="115.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="2417.5" y="132.5664">Party Lookup</text><rect fill="#ADD8E6" filter="url(#fkklqx7xxkbhj)" height="130" style="stroke:#A80036;stroke-width:1.0;" width="452" x="77" y="154.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="81" y="170.877">POST /thirdpartyTransaction/partyLookup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="186.1875">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="89" y="201.498">transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="89" y="216.8086">payee: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="97" y="232.1191">partyIdType: "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="97" y="247.4297">partyIdentifier: "+123456789"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="89" y="262.7402">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="278.0508">}</text><polygon fill="#A80036" points="526.5,307.1035,536.5,311.1035,526.5,315.1035,530.5,311.1035" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="311.1035" y2="311.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="84.5" y="306.3613">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="144.5" y="306.3613">POST /thirdpartyTransaction/partyLookup</text><polygon fill="#A80036" points="869.5,336.4141,879.5,340.4141,869.5,344.4141,873.5,340.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="340.4141" y2="340.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="555.5" y="335.6719">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="615.5" y="335.6719">partyLookup()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="172" x="896" y="353.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="900" y="369.9824">state: requestPartyLookup</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="403.0352" y2="403.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="403.0352" y2="416.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="416.0352" y2="416.0352"/><polygon fill="#A80036" points="902.5,412.0352,892.5,416.0352,902.5,420.0352,898.5,416.0352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="898.5" y="398.293">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="958.5" y="398.293">SDKRequests.requestPartiesInformation</text><polygon fill="#A80036" points="1598.5,441.3457,1608.5,445.3457,1598.5,449.3457,1602.5,445.3457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="1604.5" y1="445.3457" y2="445.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="898.5" y="440.6035">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="958.5" y="440.6035">SYNC GET /parties/{type}/{id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1620.5" x2="1662.5" y1="474.6563" y2="474.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1662.5" x2="1662.5" y1="474.6563" y2="487.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1621.5" x2="1662.5" y1="487.6563" y2="487.6563"/><polygon fill="#A80036" points="1631.5,483.6563,1621.5,487.6563,1631.5,491.6563,1627.5,487.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1627.5" y="469.9141">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1687.5" y="469.9141">retrieve PartiesInformation from Switch</text><polygon fill="#A80036" points="902.5,512.9668,892.5,516.9668,902.5,520.9668,898.5,516.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1614.5" y1="516.9668" y2="516.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="908.5" y="512.2246">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="968.5" y="512.2246">200 PartyInformation</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="139" x="896" y="529.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="900" y="546.5352">state: payeeResolved</text><polygon fill="#A80036" points="559.5,575.5879,549.5,579.5879,559.5,583.5879,555.5,579.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="579.5879" y2="579.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="565.5" y="574.8457">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="625.5" y="574.8457">partyInformation</text><polygon fill="#A80036" points="83.5,604.8984,73.5,608.8984,83.5,612.8984,79.5,608.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="608.8984" y2="608.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="89.5" y="604.1563">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="149.5" y="604.1563">200 OK PartyInformation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="353" x="2308" y="641.5332">User checks the party name, and confirms transaction to continue</text><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4930" x="0" y="678.5088"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="678.5088" y2="678.5088"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="681.5088" y2="681.5088"/><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="145" x="2392.5" y="667.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127" x="2398.5" y="684.4219">Initate Transaction</text><rect fill="#ADD8E6" filter="url(#fkklqx7xxkbhj)" height="314" style="stroke:#A80036;stroke-width:1.0;" width="393" x="77" y="706.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="81" y="722.7324">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="738.043">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="89" y="753.3535">amount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="97" y="768.6641">amount: "20.00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="97" y="783.9746">currency: "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="799.2852">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="89" y="814.5957">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="89" y="829.9063">"payee": {....},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="89" y="845.2168">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="97" y="860.5273">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="97" y="875.8379">"partyIdentifier": "qwerty-56789",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="97" y="891.1484">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="906.459">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="89" y="921.7695">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="97" y="937.0801">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="97" y="952.3906">"initiator": 'PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="97" y="967.7012">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="983.0117">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="89" y="998.3223">expiration: "2021-03-08T08:08:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="1013.6328">}</text><polygon fill="#A80036" points="526.5,1042.6855,536.5,1046.6855,526.5,1050.6855,530.5,1046.6855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="1046.6855" y2="1046.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="84.5" y="1041.9434">INIT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="132.5" y="1041.9434">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><polygon fill="#A80036" points="869.5,1071.9961,879.5,1075.9961,869.5,1079.9961,873.5,1075.9961" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="1075.9961" y2="1075.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="555.5" y="1071.2539">INIT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="603.5" y="1071.2539">initiate()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="233" x="896" y="1088.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="900" y="1105.5645">state: requestThirdpartyTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="1138.6172" y2="1138.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="1138.6172" y2="1151.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="1151.6172" y2="1151.6172"/><polygon fill="#A80036" points="902.5,1147.6172,892.5,1151.6172,902.5,1155.6172,898.5,1151.6172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="898.5" y="1133.875">INIT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="946.5" y="1133.875">SDKRequests.requestThirdpartyTransaction()</text><polygon fill="#A80036" points="2032.5,1176.9277,2042.5,1180.9277,2032.5,1184.9277,2036.5,1180.9277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="2038.5" y1="1180.9277" y2="1180.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="898.5" y="1176.1855">INIT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="946.5" y="1176.1855">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="897.5,1206.2383,887.5,1210.2383,897.5,1214.2383,893.5,1210.2383" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="2043.5" y1="1210.2383" y2="1210.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="903.5" y="1205.4961">INIT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="951.5" y="1205.4961">202 Accepted</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="229" x="891" y="1223.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="895" y="1239.8066">state: pendingTransactionInitiation</text><path d="M2964,1256.5488 L2964,1281.5488 L3224,1281.5488 L3224,1266.5488 L3214,1256.5488 L2964,1256.5488 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3214,1256.5488 L3214,1266.5488 L3224,1266.5488 L3214,1256.5488 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="2970" y="1274.1172">DFSP handles PISP transaction request</text><polygon fill="#A80036" points="3079.5,1308.1699,3089.5,1312.1699,3079.5,1316.1699,3083.5,1312.1699" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="3085.5" y1="1312.1699" y2="1312.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2061.5" y="1307.4277">INIT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="2109.5" y="1307.4277">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="2060.5,1337.4805,2050.5,1341.4805,2060.5,1345.4805,2056.5,1341.4805" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3090.5" y1="1341.4805" y2="1341.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2066.5" y="1336.7383">INIT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2114.5" y="1336.7383">202 Accepted</text><path d="M3353,1354.4805 L3353,1379.4805 L3676,1379.4805 L3676,1364.4805 L3666,1354.4805 L3353,1354.4805 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3666,1354.4805 L3666,1364.4805 L3676,1364.4805 L3666,1354.4805 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="3359" y="1372.0488">DFSP starts workflow for DFSPTransactionModel</text><polygon fill="#A80036" points="3499.5,1406.1016,3509.5,1410.1016,3499.5,1414.1016,3503.5,1410.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3096.5" x2="3505.5" y1="1410.1016" y2="1410.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3103.5" y="1405.3594">INIT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="3151.5" y="1405.3594">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="256" x="3526" y="1423.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="3530" y="1439.6699">state: transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3530" y="1454.9805">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3698" y="1454.9805">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="3713" y="1454.9805">RECEIVED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="1488.0332" y2="1488.0332"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="1488.0332" y2="1501.0332"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="1501.0332" y2="1501.0332"/><polygon fill="#A80036" points="3532.5,1497.0332,3522.5,1501.0332,3532.5,1505.0332,3528.5,1501.0332" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3528.5" y="1483.291">INIT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3576.5" y="1483.291">persist transactionRequestState for transactionRequestId</text><path d="M3274,1514.0332 L3274,1539.0332 L3755,1539.0332 L3755,1524.0332 L3745,1514.0332 L3274,1514.0332 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3745,1514.0332 L3745,1524.0332 L3755,1524.0332 L3745,1514.0332 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="3280" y="1531.6016">DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="1569.6543" y2="1569.6543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="1569.6543" y2="1582.6543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="1582.6543" y2="1582.6543"/><polygon fill="#A80036" points="3532.5,1578.6543,3522.5,1582.6543,3532.5,1586.6543,3528.5,1582.6543" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="1564.9121">INIT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="607" x="3585.5" y="1564.9121">DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)</text><path d="M3416,1595.6543 L3416,1620.6543 L3612,1620.6543 L3612,1605.6543 L3602,1595.6543 L3416,1595.6543 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3602,1595.6543 L3602,1605.6543 L3612,1605.6543 L3602,1595.6543 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3422" y="1613.2227">DFSP is happy with Consent</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="139" x="3526" y="1634.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="3530" y="1651.5332">state: consentIsValid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="1684.5859" y2="1684.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="1684.5859" y2="1697.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="1697.5859" y2="1697.5859"/><polygon fill="#A80036" points="3532.5,1693.5859,3522.5,1697.5859,3532.5,1701.5859,3528.5,1697.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="1679.8438">INIT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="3585.5" y="1679.8438">so generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="3662.5" y="1679.8438">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="3751.5" y="1679.8438">: '1234-1234-1234-1234'</text><path d="M3326,1710.5859 L3326,1735.5859 L3703,1735.5859 L3703,1720.5859 L3693,1710.5859 L3326,1710.5859 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3693,1710.5859 L3693,1720.5859 L3703,1720.5859 L3693,1710.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="3332" y="1728.1543">DFSP informs PISP that</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="3478" y="1728.1543">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="3571" y="1728.1543">has been allocated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="1766.207" y2="1766.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="1766.207" y2="1779.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="1779.207" y2="1779.207"/><polygon fill="#A80036" points="3532.5,1775.207,3522.5,1779.207,3532.5,1783.207,3528.5,1779.207" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="1761.4648">INIT-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="632" x="3585.5" y="1761.4648">SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="395" x="3526" y="1792.207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="3530" y="1808.7754">state: pendingNotifyThirdpartyAboutTransactionRequestState</text><rect fill="#ADD8E6" filter="url(#fkklqx7xxkbhj)" height="84" style="stroke:#A80036;stroke-width:1.0;" width="388" x="3526" y="1825.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="3530" y="1842.0859">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="3530" y="1857.3965">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="3538" y="1872.707">transactionId: '1234-1234-1234-1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="3538" y="1888.0176">transactionRequestState: 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="3530" y="1903.3281">}</text><polygon fill="#A80036" points="2065.5,1932.3809,2055.5,1936.3809,2065.5,1940.3809,2061.5,1936.3809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2059.5" x2="3510.5" y1="1936.3809" y2="1936.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2071.5" y="1931.6387">INIT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="2128.5" y="1931.6387">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="3499.5,1961.6914,3509.5,1965.6914,3499.5,1969.6914,3503.5,1965.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3505.5" y1="1965.6914" y2="1965.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2061.5" y="1960.9492">INIT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2118.5" y="1960.9492">202 Accepted</text><polygon fill="#A80036" points="1490.5,1991.002,1480.5,1995.002,1490.5,1999.002,1486.5,1995.002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1484.5" x2="2043.5" y1="1995.002" y2="1995.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1496.5" y="1990.2598">INIT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="1553.5" y="1990.2598">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="2037.5,2020.3125,2047.5,2024.3125,2037.5,2028.3125,2041.5,2024.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1479.5" x2="2043.5" y1="2024.3125" y2="2024.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1486.5" y="2019.5703">INIT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1543.5" y="2019.5703">202 accepted</text><polygon fill="#A80036" points="902.5,2049.623,892.5,2053.623,902.5,2057.623,898.5,2053.623" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1468.5" y1="2053.623" y2="2053.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="908.5" y="2048.8809">INIT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="965.5" y="2048.8809">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="223" x="896" y="2066.623"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="900" y="2083.1914">state: transactionRequestReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="2121.2441" y2="2121.2441"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="2121.2441" y2="2134.2441"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886.5" x2="933.5" y1="2134.2441" y2="2134.2441"/><polygon fill="#A80036" points="896.5,2130.2441,886.5,2134.2441,896.5,2138.2441,892.5,2134.2441" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="898.5" y="2116.502">INIT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="955.5" y="2116.502">store received</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="1047.5" y="2116.502">transactionId</text><path d="M633,2142.2441 L633,2381.2441 L1135,2381.2441 L1135,2152.2441 L1125,2142.2441 L633,2142.2441 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1125,2142.2441 L1125,2152.2441 L1135,2152.2441 L1125,2142.2441 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="639" y="2159.8125">There could be a race condition (time based hazard)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="639" y="2175.123">between two incoming calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2190.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="282" x="639" y="2205.7441">PUT /thirdpartyReqeusts/transaction/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="639" y="2221.0547">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="282" x="639" y="2236.3652">POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2251.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="639" y="2266.9863">so we are mitigating it by alternative two-step transitions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2282.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="639" y="2297.6074">pendingTransactionInitiation (START):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="647" y="2312.918">-&gt; (CASE-1) transactionRequestReceived -&gt; authorizationRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="647" y="2328.2285">-&gt; (CASE-2) authorizationRequestReceived -&gt; transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="639" y="2343.5391">-&gt; transactionInitiationSuccess (END)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2358.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="639" y="2374.1602">CASE-1 is visualised here</text><path d="M3403,2395.9023 L3403,2420.9023 L3626,2420.9023 L3626,2405.9023 L3616,2395.9023 L3403,2395.9023 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3616,2395.9023 L3616,2405.9023 L3626,2405.9023 L3616,2395.9023 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="3409" y="2413.4707">DFSP requires QuoteInformation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="2451.5234" y2="2451.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="2451.5234" y2="2464.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="2464.5234" y2="2464.5234"/><polygon fill="#A80036" points="3532.5,2460.5234,3522.5,2464.5234,3532.5,2468.5234,3528.5,2464.5234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="2446.7813">INIT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="3585.5" y="2446.7813">SDKRequests.requestQuote()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="186" x="3526" y="2477.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="3530" y="2494.0918">state: pendingRequestQuote</text><polygon fill="#A80036" points="2770.5,2523.1445,2760.5,2527.1445,2770.5,2531.1445,2766.5,2527.1445" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2764.5" x2="3510.5" y1="2527.1445" y2="2527.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2776.5" y="2522.4023">INIT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="2833.5" y="2522.4023">SYNC POST /quotes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2759.5" x2="2801.5" y1="2556.4551" y2="2556.4551"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2801.5" x2="2801.5" y1="2556.4551" y2="2569.4551"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2760.5" x2="2801.5" y1="2569.4551" y2="2569.4551"/><polygon fill="#A80036" points="2770.5,2565.4551,2760.5,2569.4551,2770.5,2573.4551,2766.5,2569.4551" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2766.5" y="2551.7129">INIT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="2823.5" y="2551.7129">retrieve QuoteInformation from Switch</text><polygon fill="#A80036" points="3499.5,2594.7656,3509.5,2598.7656,3499.5,2602.7656,3503.5,2598.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2754.5" x2="3505.5" y1="2598.7656" y2="2598.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2761.5" y="2594.0234">INIT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="2818.5" y="2594.0234">200 QuoteInformation</text><path d="M3265,2611.7656 L3265,2636.7656 L3763,2636.7656 L3763,2621.7656 L3753,2611.7656 L3265,2611.7656 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3753,2611.7656 L3753,2621.7656 L3763,2621.7656 L3753,2611.7656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477" x="3271" y="2629.334">DFSP has the QuoteInformation, they can now ask the PISP for authorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="2667.3867" y2="2667.3867"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="2667.3867" y2="2680.3867"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="2680.3867" y2="2680.3867"/><polygon fill="#A80036" points="3532.5,2676.3867,3522.5,2680.3867,3532.5,2684.3867,3528.5,2680.3867" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="2662.6445">INIT-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="3585.5" y="2662.6445">SDKRequests.requestAuthorization()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="251" x="3526" y="2693.3867"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="3530" y="2709.9551">state: pendingRequestAuthorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3530" y="2725.2656">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3698" y="2725.2656">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="60" x="3713" y="2725.2656">PENDING</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="2758.3184" y2="2758.3184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="2758.3184" y2="2771.3184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="2771.3184" y2="2771.3184"/><polygon fill="#A80036" points="3532.5,2767.3184,3522.5,2771.3184,3532.5,2775.3184,3528.5,2771.3184" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3528.5" y="2753.5762">INIT-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3585.5" y="2753.5762">persist transactionRequestState for transactionRequestId</text><polygon fill="#A80036" points="2065.5,2796.6289,2055.5,2800.6289,2065.5,2804.6289,2061.5,2800.6289" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2059.5" x2="3510.5" y1="2800.6289" y2="2800.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2071.5" y="2795.8867">INIT-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="2128.5" y="2795.8867">POST /thirdpartyRequests/authorizations</text><path d="M3300,2813.6289 L3300,2884.6289 L3729,2884.6289 L3729,2823.6289 L3719,2813.6289 L3300,2813.6289 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3719,2813.6289 L3719,2823.6289 L3729,2823.6289 L3719,2813.6289 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="3306" y="2831.1973">From now DFSPTransactionModel is blocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="3306" y="2846.5078">on synchronous call to POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="3306" y="2861.8184">until PISP initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="3416" y="2861.8184">Approve Transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="3562" y="2861.8184">phase.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="3306" y="2877.1289">Here timeout scenario should be handled properly</text><polygon fill="#A80036" points="3499.5,2911.1816,3509.5,2915.1816,3499.5,2919.1816,3503.5,2915.1816" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3505.5" y1="2915.1816" y2="2915.1816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2061.5" y="2910.4395">INIT-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2118.5" y="2910.4395">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="4342.5" x2="4384.5" y1="2949.4922" y2="2949.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4384.5" x2="4384.5" y1="2949.4922" y2="2962.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4337.5" x2="4384.5" y1="2962.4922" y2="2962.4922"/><polygon fill="#A80036" points="4347.5,2958.4922,4337.5,2962.4922,4347.5,2966.4922,4343.5,2962.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="4349.5" y="2944.75">INIT-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="483" x="4406.5" y="2944.75">waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="1490.5,2982.8027,1480.5,2986.8027,1490.5,2990.8027,1486.5,2986.8027" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1484.5" x2="2043.5" y1="2986.8027" y2="2986.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1496.5" y="2982.0605">INIT-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="1553.5" y="2982.0605">POST /thirdpartyRequests/authorizations</text><polygon fill="#A80036" points="2037.5,3012.1133,2047.5,3016.1133,2037.5,3020.1133,2041.5,3016.1133" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1479.5" x2="2043.5" y1="3016.1133" y2="3016.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1486.5" y="3011.3711">INIT-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1543.5" y="3011.3711">200 OK</text><polygon fill="#A80036" points="902.5,3041.4238,892.5,3045.4238,902.5,3049.4238,898.5,3045.4238" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1468.5" y1="3045.4238" y2="3045.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="908.5" y="3040.6816">INIT-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="965.5" y="3040.6816">authorizationRequestReceived()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="236" x="896" y="3088.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="900" y="3104.9922">state: authorizationRequestReceived</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="225" x="896" y="3121.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="900" y="3138.3027">state: transactionInitiationSuccess</text><polygon fill="#A80036" points="559.5,3167.3555,549.5,3171.3555,559.5,3175.3555,555.5,3171.3555" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="3171.3555" y2="3171.3555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="565.5" y="3166.6133">INIT-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="622.5" y="3166.6133">QuoteInformation, transactionId</text><polygon fill="#A80036" points="83.5,3196.666,73.5,3200.666,83.5,3204.666,79.5,3200.666" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="3200.666" y2="3200.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="89.5" y="3195.9238">INIT-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="146.5" y="3195.9238">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="158" x="2405.5" y="3233.3008">Present quote to be approved</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="2419" y="3246.2559">User signs the challenge</text><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4930" x="0" y="3283.2314"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="3283.2314" y2="3283.2314"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4930" y1="3286.2314" y2="3286.2314"/><rect fill="#EEEEEE" filter="url(#fkklqx7xxkbhj)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="160" x="2385" y="3272.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="2391" y="3289.1445">Approve Transaction</text><rect fill="#ADD8E6" filter="url(#fkklqx7xxkbhj)" height="84" style="stroke:#A80036;stroke-width:1.0;" width="399" x="77" y="3310.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="81" y="3327.4551">rnote right of PISP #Light</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="81" y="3342.7656">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="3358.0762">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="89" y="3373.3867">signedChallenge: "base64(xxx)"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="3388.6973">}</text><polygon fill="#A80036" points="526.5,3417.75,536.5,3421.75,526.5,3425.75,530.5,3421.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="3421.75" y2="3421.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="84.5" y="3417.0078">APPR-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="140.5" y="3417.0078">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><polygon fill="#A80036" points="869.5,3447.0605,879.5,3451.0605,869.5,3455.0605,873.5,3451.0605" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="3451.0605" y2="3451.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="555.5" y="3446.3184">APPR-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="611.5" y="3446.3184">approve()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="156" x="896" y="3464.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="900" y="3480.6289">state: approvalReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="3513.6816" y2="3513.6816"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="3513.6816" y2="3526.6816"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="3526.6816" y2="3526.6816"/><polygon fill="#A80036" points="902.5,3522.6816,892.5,3526.6816,902.5,3530.6816,898.5,3526.6816" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="898.5" y="3508.9395">APPR-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="508" x="954.5" y="3508.9395">SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)</text><polygon fill="#A80036" points="2032.5,3551.9922,2042.5,3555.9922,2032.5,3559.9922,2036.5,3555.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="2038.5" y1="3555.9922" y2="3555.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="898.5" y="3551.25">APPR-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="954.5" y="3551.25">PUT /authorizations/{transactionRequestId}</text><polygon fill="#A80036" points="897.5,3581.3027,887.5,3585.3027,897.5,3589.3027,893.5,3585.3027" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="2043.5" y1="3585.3027" y2="3585.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="903.5" y="3580.5605">APPR-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="959.5" y="3580.5605">202 Accepted</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="220" x="891" y="3598.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="895" y="3614.8711">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="3079.5,3643.9238,3089.5,3647.9238,3079.5,3651.9238,3083.5,3647.9238" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="3085.5" y1="3647.9238" y2="3647.9238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2061.5" y="3643.1816">APPR-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="413" x="2117.5" y="3643.1816">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="2060.5,3673.2344,2050.5,3677.2344,2060.5,3681.2344,2056.5,3677.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3090.5" y1="3677.2344" y2="3677.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2066.5" y="3672.4922">APPR-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2122.5" y="3672.4922">202 Accepted</text><polygon fill="#A80036" points="3499.5,3702.5449,3509.5,3706.5449,3499.5,3710.5449,3503.5,3706.5449" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3101.5" x2="3505.5" y1="3706.5449" y2="3706.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="3108.5" y="3701.8027">APPR-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="3164.5" y="3701.8027">200: AuthorizationInformation</text><path d="M3357,3719.5449 L3357,3744.5449 L3672,3744.5449 L3672,3729.5449 L3662,3719.5449 L3357,3719.5449 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3662,3719.5449 L3662,3729.5449 L3672,3729.5449 L3662,3719.5449 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="3363" y="3737.1133">From now DFSPTransactionModel is unblocked</text><path d="M3230,3758.8555 L3230,3783.8555 L3798,3783.8555 L3798,3768.8555 L3788,3758.8555 L3230,3758.8555 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3788,3758.8555 L3788,3768.8555 L3798,3768.8555 L3788,3758.8555 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="547" x="3236" y="3776.4238">TransactionModel checks the received AuthorizationInformation with the auth-service.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="3814.4766" y2="3814.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="3814.4766" y2="3827.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="3827.4766" y2="3827.4766"/><polygon fill="#A80036" points="3532.5,3823.4766,3522.5,3827.4766,3532.5,3831.4766,3528.5,3827.4766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="3528.5" y="3809.7344">APPR-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3584.5" y="3809.7344">generate verificationRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="3856.7871" y2="3856.7871"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="3856.7871" y2="3869.7871"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="3869.7871" y2="3869.7871"/><polygon fill="#A80036" points="3532.5,3865.7871,3522.5,3869.7871,3532.5,3873.7871,3528.5,3869.7871" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="3852.0449">APPR-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="451" x="3593.5" y="3852.0449">SDKRequests.verifyThirdpartyTransactionRequest(verificationRequestId)</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="220" x="3526" y="3882.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="3530" y="3899.3555">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="2065.5,3928.4082,2055.5,3932.4082,2065.5,3936.4082,2061.5,3932.4082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2059.5" x2="3510.5" y1="3932.4082" y2="3932.4082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2071.5" y="3927.666">APPR-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="2136.5" y="3927.666">POST /thirdpartyRequests/verifications</text><polygon fill="#A80036" points="3499.5,3957.7188,3509.5,3961.7188,3499.5,3965.7188,3503.5,3961.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3505.5" y1="3961.7188" y2="3961.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="3956.9766">APPR-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2126.5" y="3956.9766">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="2096.5" y1="3991.0293" y2="3991.0293"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2096.5" x2="2096.5" y1="3991.0293" y2="4004.0293"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2055.5" x2="2096.5" y1="4004.0293" y2="4004.0293"/><polygon fill="#A80036" points="2065.5,4000.0293,2055.5,4004.0293,2065.5,4008.0293,2061.5,4004.0293" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="3986.2871">APPR-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="475" x="2126.5" y="3986.2871">Switch asks auth-service to verify the transaction (process not shown here)</text><path d="M5,4017.0293 L5,4042.0293 L3585,4042.0293 L3585,4027.0293 L3575,4017.0293 L5,4017.0293 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3575,4017.0293 L3575,4027.0293 L3585,4027.0293 L3575,4017.0293 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="602" x="1487.5" y="4034.5977">ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here</text><polygon fill="#A80036" points="3079.5,4068.6504,3089.5,4072.6504,3079.5,4076.6504,3083.5,4072.6504" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="3085.5" y1="4072.6504" y2="4072.6504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="4067.9082">APPR-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="424" x="2126.5" y="4067.9082">PUT /thirdpartyRequests/verifications/{verificationRequestId}/error</text><polygon fill="#A80036" points="2060.5,4097.9609,2050.5,4101.9609,2060.5,4105.9609,2056.5,4101.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3090.5" y1="4101.9609" y2="4101.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2066.5" y="4097.2188">APPR-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2131.5" y="4097.2188">200 OK</text><polygon fill="#A80036" points="3499.5,4127.2715,3509.5,4131.2715,3499.5,4135.2715,3503.5,4131.2715" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3101.5" x2="3505.5" y1="4131.2715" y2="4131.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3108.5" y="4126.5293">APPR-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="3173.5" y="4126.5293">Thirdparty Transaction Request Verification failed</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="284" x="3526" y="4144.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="3530" y="4160.8398">Auth-Service is unhappy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3530" y="4176.1504">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3698" y="4176.1504">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="3713" y="4176.1504">REJECTED</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="209" x="3526" y="4192.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3530" y="4209.4609">state: failureVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="4242.5137" y2="4242.5137"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="4242.5137" y2="4255.5137"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="4255.5137" y2="4255.5137"/><polygon fill="#A80036" points="3532.5,4251.5137,3522.5,4255.5137,3532.5,4259.5137,3528.5,4255.5137" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="4237.7715">APPR-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3593.5" y="4237.7715">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="4284.8242" y2="4284.8242"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="4284.8242" y2="4297.8242"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="4297.8242" y2="4297.8242"/><polygon fill="#A80036" points="3532.5,4293.8242,3522.5,4297.8242,3532.5,4301.8242,3528.5,4297.8242" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="4280.082">APPR-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="506" x="3593.5" y="4280.082">SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)</text><polygon fill="#A80036" points="2065.5,4323.1348,2055.5,4327.1348,2065.5,4331.1348,2061.5,4327.1348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2059.5" x2="3510.5" y1="4327.1348" y2="4327.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2071.5" y="4322.3926">APPR-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="2136.5" y="4322.3926">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="3499.5,4352.4453,3509.5,4356.4453,3499.5,4360.4453,3503.5,4356.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="3505.5" y1="4356.4453" y2="4356.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="4351.7031">APPR-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="2126.5" y="4351.7031">202 Accept</text><path d="M3289,4369.4453 L3289,4394.4453 L3740,4394.4453 L3740,4379.4453 L3730,4369.4453 L3289,4369.4453 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3730,4369.4453 L3730,4379.4453 L3740,4379.4453 L3730,4369.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="3295" y="4387.0137">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="310" x="3415" y="4387.0137">DFSPTransactionModel ends its workflow here</text><polygon fill="#A80036" points="1490.5,4421.0664,1480.5,4425.0664,1490.5,4429.0664,1486.5,4425.0664" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1484.5" x2="4895.5" y1="4425.0664" y2="4425.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1496.5" y="4420.3242">APPR-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="1561.5" y="4420.3242">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="2037.5,4450.377,2047.5,4454.377,2037.5,4458.377,2041.5,4454.377" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1479.5" x2="2043.5" y1="4454.377" y2="4454.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1486.5" y="4449.6348">APPR-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1551.5" y="4449.6348">202 Accept</text><path d="M651,4467.377 L651,4492.377 L1117,4492.377 L1117,4477.377 L1107,4467.377 L651,4467.377 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1107,4467.377 L1107,4477.377 L1117,4477.377 L1107,4467.377 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="657" y="4484.9453">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="325" x="777" y="4484.9453">PISPTransactionModel will end its workflow here</text><polygon fill="#A80036" points="902.5,4518.998,892.5,4522.998,902.5,4526.998,898.5,4522.998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1473.5" y1="4522.998" y2="4522.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="908.5" y="4518.2559">APPR-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="973.5" y="4518.2559">authorizationRejected()</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="183" x="896" y="4535.998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="900" y="4552.5664">state: rejectedAuthorization</text><polygon fill="#A80036" points="559.5,4581.6191,549.5,4585.6191,559.5,4589.6191,555.5,4585.6191" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="4585.6191" y2="4585.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="565.5" y="4580.877">APPR-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="630.5" y="4580.877">not approved: authorization is rejected</text><polygon fill="#A80036" points="88.5,4610.9297,78.5,4614.9297,88.5,4618.9297,84.5,4614.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="537.5" y1="4614.9297" y2="4614.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="94.5" y="4610.1875">APPR-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="159.5" y="4610.1875">500: authorization is rejected</text><path d="M5,4627.9297 L5,4652.9297 L3585,4652.9297 L3585,4637.9297 L3575,4627.9297 L5,4627.9297 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3575,4627.9297 L3575,4637.9297 L3585,4637.9297 L3575,4627.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1483" y="4645.498">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="491" x="1603" y="4645.498">auth-service verifies transfer DFSPTransactionModel continues workflow</text><polygon fill="#A80036" points="3079.5,4679.5508,3089.5,4683.5508,3079.5,4687.5508,3083.5,4683.5508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2054.5" x2="3085.5" y1="4683.5508" y2="4683.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="4678.8086">APPR-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="2126.5" y="4678.8086">PUT /thirdpartyRequests/verifications/{verificationRequestId}</text><polygon fill="#A80036" points="2065.5,4708.8613,2055.5,4712.8613,2065.5,4716.8613,2061.5,4712.8613" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2059.5" x2="3090.5" y1="4712.8613" y2="4712.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2071.5" y="4708.1191">APPR-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2136.5" y="4708.1191">200 OK</text><polygon fill="#A80036" points="3499.5,4738.1719,3509.5,4742.1719,3499.5,4746.1719,3503.5,4742.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3101.5" x2="3505.5" y1="4742.1719" y2="4742.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3108.5" y="4737.4297">APPR-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="3173.5" y="4737.4297">Thirdparty Transaction Request Verification passed</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="268" x="3526" y="4755.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="3530" y="4771.7402">Auth-Service is happy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3530" y="4787.0508">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3698" y="4787.0508">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="3713" y="4787.0508">ACCEPTED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="4820.1035" y2="4820.1035"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="4820.1035" y2="4833.1035"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="4833.1035" y2="4833.1035"/><polygon fill="#A80036" points="3532.5,4829.1035,3522.5,4833.1035,3532.5,4837.1035,3528.5,4833.1035" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="4815.3613">APPR-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3593.5" y="4815.3613">persist transactionRequestState for transactionRequestId</text><path d="M3337,4846.1035 L3337,4871.1035 L3691,4871.1035 L3691,4856.1035 L3681,4846.1035 L3337,4846.1035 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3681,4846.1035 L3681,4856.1035 L3691,4856.1035 L3681,4846.1035 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="3343" y="4863.6719">DFSP is happy, so initiates the Transfer for transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="4901.7246" y2="4901.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="4901.7246" y2="4914.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="4914.7246" y2="4914.7246"/><polygon fill="#A80036" points="3532.5,4910.7246,3522.5,4914.7246,3532.5,4918.7246,3528.5,4914.7246" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="4896.9824">APPR-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="3593.5" y="4896.9824">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="3651.5" y="4896.9824">transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="4944.0352" y2="4944.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="4944.0352" y2="4957.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="4957.0352" y2="4957.0352"/><polygon fill="#A80036" points="3532.5,4953.0352,3522.5,4957.0352,3532.5,4961.0352,3528.5,4957.0352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="4939.293">APPR-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="3593.5" y="4939.293">transfer(transferId)</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="150" x="3526" y="4970.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="3530" y="4986.6035">state: pendingTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="5019.6563" y2="5019.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="5019.6563" y2="5032.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="5032.6563" y2="5032.6563"/><polygon fill="#A80036" points="3532.5,5028.6563,3522.5,5032.6563,3532.5,5036.6563,3528.5,5032.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="5014.9141">APPR-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="3593.5" y="5014.9141">SDKRequests.requestTransfer(transferId, transferPayload)</text><polygon fill="#A80036" points="2770.5,5057.9668,2760.5,5061.9668,2770.5,5065.9668,2766.5,5061.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2764.5" x2="3510.5" y1="5061.9668" y2="5061.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2776.5" y="5057.2246">APPR-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="2841.5" y="5057.2246">SYNC POST /simpleTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2759.5" x2="2801.5" y1="5091.2773" y2="5091.2773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2801.5" x2="2801.5" y1="5091.2773" y2="5104.2773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2760.5" x2="2801.5" y1="5104.2773" y2="5104.2773"/><polygon fill="#A80036" points="2770.5,5100.2773,2760.5,5104.2773,2770.5,5108.2773,2766.5,5104.2773" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2766.5" y="5086.5352">APPR-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="2831.5" y="5086.5352">request Switch to realize simple transfer</text><polygon fill="#A80036" points="3499.5,5129.5879,3509.5,5133.5879,3499.5,5137.5879,3503.5,5133.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2754.5" x2="3505.5" y1="5133.5879" y2="5133.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2761.5" y="5128.8457">APPR-35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2826.5" y="5128.8457">202: Transfer done</text><path d="M3380,5146.5879 L3380,5171.5879 L3648,5171.5879 L3648,5156.5879 L3638,5146.5879 L3380,5146.5879 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3638,5146.5879 L3638,5156.5879 L3648,5156.5879 L3638,5146.5879 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="3386" y="5164.1563">DFSP notifies PISP that Transfer is done</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3521.5" x2="3563.5" y1="5202.209" y2="5202.209"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3563.5" x2="3563.5" y1="5202.209" y2="5215.209"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3522.5" x2="3563.5" y1="5215.209" y2="5215.209"/><polygon fill="#A80036" points="3532.5,5211.209,3522.5,5215.209,3532.5,5219.209,3528.5,5215.209" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3528.5" y="5197.4668">APPR-36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="3593.5" y="5197.4668">SDKRequests.notifyThirdpartyAboutTransfer(transferId)</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="292" x="3526" y="5228.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="3530" y="5244.7773">state: pendingNotifyThirdpartyAboutTransfer</text><polygon fill="#A80036" points="2065.5,5273.8301,2055.5,5277.8301,2065.5,5281.8301,2061.5,5277.8301" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2059.5" x2="3510.5" y1="5277.8301" y2="5277.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2071.5" y="5273.0879">APPR-37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="2136.5" y="5273.0879">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="3504.5,5303.1406,3514.5,5307.1406,3504.5,5311.1406,3508.5,5307.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2054.5" x2="3510.5" y1="5307.1406" y2="5307.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2061.5" y="5302.3984">APPR-38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2126.5" y="5302.3984">202 Accepted</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="218" x="3521" y="5320.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="3525" y="5336.709">state: transactionRequestSuccess</text><path d="M672,5353.4512 L672,5378.4512 L1096,5378.4512 L1096,5363.4512 L1086,5353.4512 L672,5353.4512 " fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1086,5353.4512 L1086,5363.4512 L1096,5363.4512 L1086,5353.4512 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="678" y="5371.0195">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283" x="798" y="5371.0195">PISPTransactionModel continues workflow</text><polygon fill="#A80036" points="1490.5,5405.0723,1480.5,5409.0723,1490.5,5413.0723,1486.5,5409.0723" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1484.5" x2="2043.5" y1="5409.0723" y2="5409.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1496.5" y="5404.3301">APPR-39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="1561.5" y="5404.3301">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="2037.5,5434.3828,2047.5,5438.3828,2037.5,5442.3828,2041.5,5438.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1479.5" x2="2043.5" y1="5438.3828" y2="5438.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1486.5" y="5433.6406">APPR-40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1551.5" y="5433.6406">200 OK</text><polygon fill="#A80036" points="902.5,5463.6934,892.5,5467.6934,902.5,5471.6934,898.5,5467.6934" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1473.5" y1="5467.6934" y2="5467.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="908.5" y="5462.9512">APPR-41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="973.5" y="5462.9512">transactionSuccess(transactionRequestId)</text><rect fill="#FBFB77" filter="url(#fkklqx7xxkbhj)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="168" x="896" y="5480.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="900" y="5497.2617">state: transactionSuccess</text><polygon fill="#A80036" points="559.5,5526.3145,549.5,5530.3145,559.5,5534.3145,555.5,5530.3145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="5530.3145" y2="5530.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="565.5" y="5525.5723">APPR-42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="630.5" y="5525.5723">Transaction &amp; Transfer are done</text><polygon fill="#A80036" points="83.5,5555.625,73.5,5559.625,83.5,5563.625,79.5,5559.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="5559.625" y2="5559.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="89.5" y="5554.8828">APPR-43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="154.5" y="5554.8828">200 OK</text><!--MD5=[6350aaaaeaada303da4cf2ba3575869e]
@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
' TODO: line up with state-models.md doc
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

' TODO: party lookup details
PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

'TODO: add authorization details
PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_TP_IN -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
DFSP_TM -> DFSP_TM: generate verificationRequestId
DFSP_TM -> DFSP_TM: SDKRequests.verifyThirdpartyTransactionRequest(verificationRequestId)
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> Switch: POST /thirdpartyRequests/verifications
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> Switch: Switch asks auth-service to verify the transaction (process not shown here)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: Thirdparty Transaction Request Verification failed

rnote right of DFSP_TM: Auth-Service is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **auth-service verifies transfer DFSPTransactionModel continues workflow**
end note

activate Switch
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}
DFSP_TP_IN - -> Switch: 200 OK
DFSP_TP_IN -> DFSP_TM: Thirdparty Transaction Request Verification passed
deactivate Switch

rnote right of DFSP_TM: Auth-Service is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
Switch - -> DFSP_TM: 202 Accepted
activate -> activate: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate activate
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_TP_IN -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
note over DFSP_TM
  TransactionModel checks the received AuthorizationInformation with the auth-service.
end note
DFSP_TM -> DFSP_TM: generate verificationRequestId
DFSP_TM -> DFSP_TM: SDKRequests.verifyThirdpartyTransactionRequest(verificationRequestId)
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> Switch: POST /thirdpartyRequests/verifications
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> Switch: Switch asks auth-service to verify the transaction (process not shown here)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}/error
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch

DFSP_TP_IN -> DFSP_TM: Thirdparty Transaction Request Verification failed

rnote right of DFSP_TM: Auth-Service is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **auth-service verifies transfer DFSPTransactionModel continues workflow**
end note

activate Switch
Switch -> DFSP_TP_IN: PUT /thirdpartyRequests/verifications/{verificationRequestId}
DFSP_TP_IN - -> Switch: 200 OK
DFSP_TP_IN -> DFSP_TM: Thirdparty Transaction Request Verification passed
deactivate Switch

rnote right of DFSP_TM: Auth-Service is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.7(Sun May 23 22:10:07 ACST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>