<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5370px" preserveAspectRatio="none" style="width:4861px;height:5370px;background:#FFFFFF;" version="1.1" viewBox="0 0 4861 5370" width="4861px" zoomAndPan="magnify"><defs><filter height="300%" id="fan616bmhsmwz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="147" x="2353.5" y="28.708">PISP Transaction</text><rect fill="#DDDDDD" height="5323.9141" style="stroke:#A80036;stroke-width:1.0;" width="1084.5" x="481.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="933.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="5323.9141" style="stroke:#A80036;stroke-width:1.0;" width="467.5" x="1568" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191" x="1706.25" y="53.02">PISP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5323.9141" style="stroke:#A80036;stroke-width:1.0;" width="73" x="2037.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="2040.5" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="5323.9141" style="stroke:#A80036;stroke-width:1.0;" width="719.5" x="2512.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197" x="2773.75" y="53.02">DFSP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5323.9141" style="stroke:#A80036;stroke-width:1.0;" width="1127.5" x="3657.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="4128.25" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="2212.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1838.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3470.2656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="2212.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1838.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3470.2656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3096.1953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3499.3984"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4364.8516"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5217.1719"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="3037.9297"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="4267.4531"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="5158.9063"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1634" y="442.2422"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="2937.5313"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="3603.7969"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4170.0547"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="5028.375"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2573" y="3695.1953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="177.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2823.8672"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="3753.4609"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="4813.5781"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3718" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1858.6328" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3983" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3983" y1="1400.0938" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="3993" y1="1400.0938" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3993" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1745.1719" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3983" y="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3983" y1="3312.3359" y2="5057.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="3993" y1="3312.3359" y2="5057.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3993" y1="5057.5078" y2="5057.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="74" x2="74" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="74" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="552.5" x2="552.5" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="900" x2="900" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900" x2="900" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1500" x2="1500" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1500" x2="1500" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1500" x2="1500" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1639" x2="1639" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1639" x2="1639" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1639" x2="1639" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1969.5" x2="1969.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1969.5" x2="1969.5" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1969.5" x2="1969.5" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2073.5" x2="2073.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2073.5" x2="2073.5" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2073.5" x2="2073.5" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2577.5" x2="2577.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2577.5" x2="2577.5" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2577.5" x2="2577.5" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3161" x2="3161" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3161" x2="3161" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3161" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3722.5" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3722.5" x2="3722.5" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3722.5" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3722.5" x2="3722.5" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3722.5" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3988" x2="3988" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3988" x2="3988" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3988" x2="3988" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3988" x2="3988" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3988" x2="3988" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4714" x2="4714" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4714" x2="4714" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4714" x2="4714" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4714" x2="4714" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4714" x2="4714" y1="3312.3359" y2="5326.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4820" x2="4820" y1="95.3828" y2="612.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4820" x2="4820" y1="612.9063" y2="653.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4820" x2="4820" y1="653.7109" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4820" x2="4820" y1="3258.7266" y2="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4820" x2="4820" y1="3312.3359" y2="5326.5703"/><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="18" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="25" y="5345.5654">PISP Backend</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="485.5" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="492.5" y="5345.5654">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="80.0811">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="167" x="815" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="822" y="5345.5654">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1439" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1446" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1439" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1446" y="5345.5654">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1572" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1579" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1572" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1579" y="5345.5654">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1908.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1915.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1908.5" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1915.5" y="5345.5654">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2042.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2049.5" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="2042.5" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2049.5" y="5345.5654">Switch</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="2516.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="2523.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="2516.5" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="2523.5" y="5345.5654">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3094" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3101" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="3094" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="3101" y="5345.5654">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3661.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3668.5" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3661.5" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3668.5" y="5345.5654">inbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3899" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3906" y="80.0811">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="174" x="3899" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="3906" y="5345.5654">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4647" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4654" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="4647" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="4654" y="5345.5654">outbound-server</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="4791" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="4798" y="80.0811">Swich</text><rect fill="#FEFECE" filter="url(#fan616bmhsmwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="54" x="4791" y="5325.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="4798" y="5345.5654">Swich</text><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="2212.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1838.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="69.5" y="3470.2656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="296.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="308.7109"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="2212.0938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="1038.6328"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1838.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="547.5" y="3470.2656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="237.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="337.8438"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="1067.7656"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="68.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="2039.8828"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="125.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3096.1953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="3499.3984"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="4364.8516"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="895.5" y="5217.1719"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="1981.6172"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="88.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="3037.9297"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="4267.4531"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1495.5" y="5158.9063"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1634" y="442.2422"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1172.1641"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="1923.3516"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="2937.5313"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="3603.7969"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="126.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="4170.0547"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="159.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2069" y="5028.375"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2573" y="3695.1953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2509.6719"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="177.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="2823.8672"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="3753.4609"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3156" y="4813.5781"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="97.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3718" y="1302.6953"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1858.6328" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3983" y="1400.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3983" y1="1400.0938" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="3993" y1="1400.0938" y2="3258.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3993" y1="1400.0938" y2="1400.0938"/><rect fill="#FFFFFF" filter="url(#fan616bmhsmwz)" height="1745.1719" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3983" y="3312.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3983" y1="3312.3359" y2="5057.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="3993" y1="3312.3359" y2="5057.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3983" x2="3993" y1="5057.5078" y2="5057.5078"/><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4854" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="117" x="2368.5" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="2374.5" y="131.4497">Party Lookup</text><rect fill="#ADD8E6" filter="url(#fan616bmhsmwz)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="448" x="79" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="83" y="169.5825">POST /thirdpartyTransaction/partyLookup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="184.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="432" x="91" y="199.8481">transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="91" y="214.981">payee: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="99" y="230.1138">partyIdType: "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="99" y="245.2466">partyIdentifier: "+123456789"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="91" y="260.3794">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="275.5122">}</text><polygon fill="#A80036" points="535.5,304.7109,545.5,308.7109,535.5,312.7109,539.5,308.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="308.7109" y2="308.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="303.645">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="144.5" y="303.645">POST /thirdpartyTransaction/partyLookup</text><polygon fill="#A80036" points="883.5,333.8438,893.5,337.8438,883.5,341.8438,887.5,337.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="337.8438" y2="337.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="332.7778">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="622.5" y="332.7778">partyLookup()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="177" x="910" y="350.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="914" y="366.9106">state: requestPartyLookup</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="400.1094" y2="400.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="400.1094" y2="413.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="413.1094" y2="413.1094"/><polygon fill="#A80036" points="916.5,409.1094,906.5,413.1094,916.5,417.1094,912.5,413.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="395.0435">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="970.5" y="395.0435">SDKRequests.requestPartiesInformation</text><polygon fill="#A80036" points="1622,438.2422,1632,442.2422,1622,446.2422,1626,442.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="1628" y1="442.2422" y2="442.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="437.1763">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="970.5" y="437.1763">SYNC GET /parties/{type}/{id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1644" x2="1686" y1="471.375" y2="471.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1686" x2="1686" y1="471.375" y2="484.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1645" x2="1686" y1="484.375" y2="484.375"/><polygon fill="#A80036" points="1655,480.375,1645,484.375,1655,488.375,1651,484.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1651" y="466.3091">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1709" y="466.3091">retrieve PartiesInformation from Switch</text><polygon fill="#A80036" points="916.5,509.5078,906.5,513.5078,916.5,517.5078,912.5,513.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1638" y1="513.5078" y2="513.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="922.5" y="508.4419">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="980.5" y="508.4419">200 PartyInformation</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="145" x="910" y="526.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="914" y="542.5747">state: payeeResolved</text><polygon fill="#A80036" points="568.5,571.7734,558.5,575.7734,568.5,579.7734,564.5,575.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="575.7734" y2="575.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="574.5" y="570.7075">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="632.5" y="570.7075">partyInformation</text><polygon fill="#A80036" points="85.5,600.9063,75.5,604.9063,85.5,608.9063,81.5,604.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="604.9063" y2="604.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="91.5" y="599.8403">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="149.5" y="599.8403">200 OK PartyInformation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="379" x="2257.75" y="637.1167">User checks the party name, and confirms transaction to continue</text><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4854" x="0" y="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="674.2773" y2="674.2773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="677.2773" y2="677.2773"/><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="156" x="2349" y="663.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137" x="2355" y="679.7778">Initate Transaction</text><rect fill="#ADD8E6" filter="url(#fan616bmhsmwz)" height="310" style="stroke:#A80036;stroke-width:1.0;" width="395" x="79" y="701.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="83" y="717.9106">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="733.0435">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="91" y="748.1763">amount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="99" y="763.3091">amount: "20.00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="99" y="778.4419">currency: "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="793.5747">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="91" y="808.7075">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="91" y="823.8403">"payee": {....},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="91" y="838.9731">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="99" y="854.106">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="99" y="869.2388">"partyIdentifier": "qwerty-56789",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="99" y="884.3716">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="899.5044">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="91" y="914.6372">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="99" y="929.77">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="99" y="944.9028">"initiator": 'PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="99" y="960.0356">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="91" y="975.1685">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="91" y="990.3013">expiration: "2021-03-08T08:08:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="1005.4341">}</text><polygon fill="#A80036" points="535.5,1034.6328,545.5,1038.6328,535.5,1042.6328,539.5,1038.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="1038.6328" y2="1038.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="86.5" y="1033.5669">INIT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="131.5" y="1033.5669">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><polygon fill="#A80036" points="883.5,1063.7656,893.5,1067.7656,883.5,1071.7656,887.5,1067.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="1067.7656" y2="1067.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="564.5" y="1062.6997">INIT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="609.5" y="1062.6997">initiate()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="236" x="910" y="1080.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="914" y="1096.8325">state: requestThirdpartyTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="1130.0313" y2="1130.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="1130.0313" y2="1143.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="1143.0313" y2="1143.0313"/><polygon fill="#A80036" points="916.5,1139.0313,906.5,1143.0313,916.5,1147.0313,912.5,1143.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1124.9653">INIT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="957.5" y="1124.9653">SDKRequests.requestThirdpartyTransaction()</text><polygon fill="#A80036" points="2057,1168.1641,2067,1172.1641,2057,1176.1641,2061,1172.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2063" y1="1172.1641" y2="1172.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="912.5" y="1167.0981">INIT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="957.5" y="1167.0981">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="911.5,1197.2969,901.5,1201.2969,911.5,1205.2969,907.5,1201.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2068" y1="1201.2969" y2="1201.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="917.5" y="1196.231">INIT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="962.5" y="1196.231">202 Accepted</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="905" y="1214.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="909" y="1230.3638">state: pendingTransactionInitiation</text><path d="M3586,1247.4297 L3586,1272.4297 L3856,1272.4297 L3856,1257.4297 L3846,1247.4297 L3586,1247.4297 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3846,1247.4297 L3846,1257.4297 L3856,1257.4297 L3846,1247.4297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="3592" y="1264.4966">DFSP handles PISP transaction request</text><polygon fill="#A80036" points="3706,1298.6953,3716,1302.6953,3706,1306.6953,3710,1302.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="3712" y1="1302.6953" y2="1302.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2086" y="1297.6294">INIT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="2131" y="1297.6294">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="2085,1327.8281,2075,1331.8281,2085,1335.8281,2081,1331.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3717" y1="1331.8281" y2="1331.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="2091" y="1326.7622">INIT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2136" y="1326.7622">202 Accepted</text><path d="M3824,1344.8281 L3824,1369.8281 L4148,1369.8281 L4148,1354.8281 L4138,1344.8281 L3824,1344.8281 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4138,1344.8281 L4138,1354.8281 L4148,1354.8281 L4138,1344.8281 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="3830" y="1361.895">DFSP starts workflow for DFSPTransactionModel</text><polygon fill="#A80036" points="3971,1396.0938,3981,1400.0938,3971,1404.0938,3975,1400.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723" x2="3977" y1="1400.0938" y2="1400.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="3730" y="1395.0278">INIT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3775" y="1395.0278">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="281" x="3998" y="1413.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="4002" y="1429.1606">state: transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="4002" y="1444.2935">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4189" y="1444.2935">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="4203" y="1444.2935">RECEIVED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="1477.4922" y2="1477.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="1477.4922" y2="1490.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="1490.4922" y2="1490.4922"/><polygon fill="#A80036" points="4004,1486.4922,3994,1490.4922,4004,1494.4922,4000,1490.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="4000" y="1472.4263">INIT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="4045" y="1472.4263">persist transactionRequestState for transactionRequestId</text><path d="M3745,1503.4922 L3745,1528.4922 L4226,1528.4922 L4226,1513.4922 L4216,1503.4922 L3745,1503.4922 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4216,1503.4922 L4216,1513.4922 L4226,1513.4922 L4216,1503.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="3751" y="1520.5591">DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="1558.7578" y2="1558.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="1558.7578" y2="1571.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="1571.7578" y2="1571.7578"/><polygon fill="#A80036" points="4004,1567.7578,3994,1571.7578,4004,1575.7578,4000,1571.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="1553.6919">INIT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="624" x="4054" y="1553.6919">DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)</text><path d="M3887,1584.7578 L3887,1609.7578 L4085,1609.7578 L4085,1594.7578 L4075,1584.7578 L3887,1584.7578 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4075,1584.7578 L4075,1594.7578 L4085,1594.7578 L4075,1584.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="3893" y="1601.8247">DFSP is happy with Consent</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="141" x="3998" y="1623.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="4002" y="1639.9575">state: consentIsValid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="1673.1563" y2="1673.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="1673.1563" y2="1686.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="1686.1563" y2="1686.1563"/><polygon fill="#A80036" points="4004,1682.1563,3994,1686.1563,4004,1690.1563,4000,1686.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="1668.0903">INIT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="4054" y="1668.0903">so generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="4135" y="1668.0903">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="4232" y="1668.0903">: '1234-1234-1234-1234'</text><path d="M3788,1699.1563 L3788,1724.1563 L4183,1724.1563 L4183,1709.1563 L4173,1699.1563 L3788,1699.1563 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4173,1699.1563 L4173,1709.1563 L4183,1709.1563 L4173,1699.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="3794" y="1716.2231">DFSP informs PISP that</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="3946" y="1716.2231">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="4047" y="1716.2231">has been allocated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="1754.4219" y2="1754.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="1754.4219" y2="1767.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="1767.4219" y2="1767.4219"/><polygon fill="#A80036" points="4004,1763.4219,3994,1767.4219,4004,1771.4219,4000,1767.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="1749.356">INIT-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="648" x="4054" y="1749.356">SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="400" x="3998" y="1780.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="392" x="4002" y="1796.4888">state: pendingNotifyThirdpartyAboutTransactionRequestState</text><rect fill="#ADD8E6" filter="url(#fan616bmhsmwz)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="393" x="3998" y="1813.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="4002" y="1829.6216">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="4002" y="1844.7544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="4010" y="1859.8872">transactionId: '1234-1234-1234-1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="4010" y="1875.02">transactionRequestState: 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="4002" y="1890.1528">}</text><polygon fill="#A80036" points="2090,1919.3516,2080,1923.3516,2090,1927.3516,2086,1923.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3982" y1="1923.3516" y2="1923.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2096" y="1918.2856">INIT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="2150" y="1918.2856">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="3971,1948.4844,3981,1952.4844,3971,1956.4844,3975,1952.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3977" y1="1952.4844" y2="1952.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2086" y="1947.4185">INIT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2140" y="1947.4185">202 Accepted</text><polygon fill="#A80036" points="1516.5,1977.6172,1506.5,1981.6172,1516.5,1985.6172,1512.5,1981.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="1981.6172" y2="1981.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1522.5" y="1976.5513">INIT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="1576.5" y="1976.5513">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="2062,2006.75,2072,2010.75,2062,2014.75,2066,2010.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="2010.75" y2="2010.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1512.5" y="2005.6841">INIT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="1566.5" y="2005.6841">202 accepted</text><polygon fill="#A80036" points="916.5,2035.8828,906.5,2039.8828,916.5,2043.8828,912.5,2039.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1494.5" y1="2039.8828" y2="2039.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="2034.8169">INIT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="976.5" y="2034.8169">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="230" x="910" y="2052.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="914" y="2068.9497">state: transactionRequestReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="2107.1484" y2="2107.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="2107.1484" y2="2120.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="900.5" x2="947.5" y1="2120.1484" y2="2120.1484"/><polygon fill="#A80036" points="910.5,2116.1484,900.5,2120.1484,910.5,2124.1484,906.5,2120.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="912.5" y="2102.0825">INIT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="966.5" y="2102.0825">store received</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="1061.5" y="2102.0825">transactionId</text><path d="M644,2128.1484 L644,2364.1484 L1153,2364.1484 L1153,2138.1484 L1143,2128.1484 L644,2128.1484 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1143,2128.1484 L1143,2138.1484 L1153,2138.1484 L1143,2128.1484 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="650" y="2145.2153">There could be a race condition (time based hazard)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="650" y="2160.3481">between two incoming calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2175.481"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="306" x="650" y="2190.6138">PUT /thirdpartyReqeusts/transaction/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="650" y="2205.7466">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301" x="650" y="2220.8794">POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2236.0122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="650" y="2251.145">so we are mitigating it by alternative two-step transitions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2266.2778"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="650" y="2281.4106">pendingTransactionInitiation (START):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2296.5435">-&gt; (CASE-1) transactionRequestReceived -&gt; authorizationRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="658" y="2311.6763">-&gt; (CASE-2) authorizationRequestReceived -&gt; transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="650" y="2326.8091">-&gt; transactionInitiationSuccess (END)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="654" y="2341.9419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="650" y="2357.0747">CASE-1 is visualised here</text><path d="M3872,2379.1406 L3872,2404.1406 L4099,2404.1406 L4099,2389.1406 L4089,2379.1406 L3872,2379.1406 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4089,2379.1406 L4089,2389.1406 L4099,2389.1406 L4089,2379.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="3878" y="2396.2075">DFSP requires QuoteInformation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="2434.4063" y2="2434.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="2434.4063" y2="2447.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="2447.4063" y2="2447.4063"/><polygon fill="#A80036" points="4004,2443.4063,3994,2447.4063,4004,2451.4063,4000,2447.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="2429.3403">INIT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="4054" y="2429.3403">SDKRequests.requestQuote()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="191" x="3998" y="2460.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="4002" y="2476.4731">state: pendingRequestQuote</text><polygon fill="#A80036" points="3177,2505.6719,3167,2509.6719,3177,2513.6719,3173,2509.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3171" x2="3982" y1="2509.6719" y2="2509.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3183" y="2504.606">INIT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="3237" y="2504.606">SYNC POST /quotes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3166" x2="3208" y1="2538.8047" y2="2538.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3208" x2="3208" y1="2538.8047" y2="2551.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3167" x2="3208" y1="2551.8047" y2="2551.8047"/><polygon fill="#A80036" points="3177,2547.8047,3167,2551.8047,3177,2555.8047,3173,2551.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3173" y="2533.7388">INIT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="3227" y="2533.7388">retrieve QuoteInformation from Switch</text><polygon fill="#A80036" points="3971,2576.9375,3981,2580.9375,3971,2584.9375,3975,2580.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3977" y1="2580.9375" y2="2580.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3168" y="2575.8716">INIT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="3222" y="2575.8716">200 QuoteInformation</text><path d="M3732,2593.9375 L3732,2618.9375 L4239,2618.9375 L4239,2603.9375 L4229,2593.9375 L3732,2593.9375 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4229,2593.9375 L4229,2603.9375 L4239,2603.9375 L4229,2593.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="486" x="3738" y="2611.0044">DFSP has the QuoteInformation, they can now ask the PISP for authorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="2649.2031" y2="2649.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="2649.2031" y2="2662.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="2662.2031" y2="2662.2031"/><polygon fill="#A80036" points="4004,2658.2031,3994,2662.2031,4004,2666.2031,4000,2662.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="2644.1372">INIT-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="4054" y="2644.1372">SDKRequests.requestAuthorization()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="276" x="3998" y="2675.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="4002" y="2691.27">state: pendingRequestAuthorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="4002" y="2706.4028">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4189" y="2706.4028">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="4203" y="2706.4028">PENDING</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="2739.6016" y2="2739.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="2739.6016" y2="2752.6016"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="2752.6016" y2="2752.6016"/><polygon fill="#A80036" points="4004,2748.6016,3994,2752.6016,4004,2756.6016,4000,2752.6016" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="2734.5356">INIT-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="4054" y="2734.5356">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="2781.7344" y2="2781.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="2781.7344" y2="2794.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="2794.7344" y2="2794.7344"/><polygon fill="#A80036" points="4004,2790.7344,3994,2794.7344,4004,2798.7344,4000,2794.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="4000" y="2776.6685">INIT-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="4054" y="2776.6685">SDKRequests.requestAuthorization(QuoteInformation)</text><polygon fill="#A80036" points="3177,2819.8672,3167,2823.8672,3177,2827.8672,3173,2823.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3171" x2="3982" y1="2823.8672" y2="2823.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3183" y="2818.8013">INIT-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="3237" y="2818.8013">SYNC POST /thirdpartyRequests/authorizations</text><path d="M3773,2836.8672 L3773,2906.8672 L4199,2906.8672 L4199,2846.8672 L4189,2836.8672 L3773,2836.8672 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4189,2836.8672 L4189,2846.8672 L4199,2846.8672 L4189,2836.8672 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="3779" y="2853.9341">From now DFSPTransactionModel is blocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="3779" y="2869.0669">on synchronous call to POST /thirdpartyRequests/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="3779" y="2884.1997">until PISP initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="3889" y="2884.1997">Approve Transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="4045" y="2884.1997">phase.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="3779" y="2899.3325">Here timeout scenario should be handled properly</text><polygon fill="#A80036" points="2090,2933.5313,2080,2937.5313,2090,2941.5313,2086,2937.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3155" y1="2937.5313" y2="2937.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2096" y="2932.4653">INIT-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="2150" y="2932.4653">POST /thirdpartyRequests/authorizations</text><polygon fill="#A80036" points="3144,2962.6641,3154,2966.6641,3144,2970.6641,3148,2966.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3150" y1="2966.6641" y2="2966.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="2086" y="2961.5981">INIT-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2140" y="2961.5981">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3166" x2="3208" y1="3000.7969" y2="3000.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3208" x2="3208" y1="3000.7969" y2="3013.7969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3208" y1="3013.7969" y2="3013.7969"/><polygon fill="#A80036" points="3171,3009.7969,3161,3013.7969,3171,3017.7969,3167,3013.7969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="3173" y="2995.731">INIT-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="3227" y="2995.731">waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="1516.5,3033.9297,1506.5,3037.9297,1516.5,3041.9297,1512.5,3037.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="3037.9297" y2="3037.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1522.5" y="3032.8638">INIT-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="1576.5" y="3032.8638">POST /thirdpartyRequests/authorizations</text><polygon fill="#A80036" points="2062,3063.0625,2072,3067.0625,2062,3071.0625,2066,3067.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="3067.0625" y2="3067.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1512.5" y="3061.9966">INIT-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1566.5" y="3061.9966">200 OK</text><polygon fill="#A80036" points="916.5,3092.1953,906.5,3096.1953,916.5,3100.1953,912.5,3096.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1494.5" y1="3096.1953" y2="3096.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="922.5" y="3091.1294">INIT-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="976.5" y="3091.1294">authorizationRequestReceived()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="242" x="910" y="3139.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="914" y="3155.2622">state: authorizationRequestReceived</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="228" x="910" y="3172.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="914" y="3188.395">state: transactionInitiationSuccess</text><polygon fill="#A80036" points="568.5,3217.5938,558.5,3221.5938,568.5,3225.5938,564.5,3221.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="3221.5938" y2="3221.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="574.5" y="3216.5278">INIT-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="628.5" y="3216.5278">QuoteInformation, transactionId</text><polygon fill="#A80036" points="85.5,3246.7266,75.5,3250.7266,85.5,3254.7266,81.5,3250.7266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="3250.7266" y2="3250.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="91.5" y="3245.6606">INIT-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="145.5" y="3245.6606">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="2362.25" y="3282.937">Present quote to be approved</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2376.25" y="3295.7417">User signs the challenge</text><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4854" x="0" y="3332.9023"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="3332.9023" y2="3332.9023"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4854" y1="3335.9023" y2="3335.9023"/><rect fill="#EEEEEE" filter="url(#fan616bmhsmwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="171" x="2341.5" y="3322.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="2347.5" y="3338.4028">Approve Transaction</text><rect fill="#ADD8E6" filter="url(#fan616bmhsmwz)" height="83" style="stroke:#A80036;stroke-width:1.0;" width="404" x="79" y="3360.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="83" y="3376.5356">rnote right of PISP #Light</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="83" y="3391.6685">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3406.8013">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="91" y="3421.9341">signedChallenge: "base64(xxx)"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="83" y="3437.0669">}</text><polygon fill="#A80036" points="535.5,3466.2656,545.5,3470.2656,535.5,3474.2656,539.5,3470.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="79.5" x2="541.5" y1="3470.2656" y2="3470.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="86.5" y="3465.1997">APPR-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="144.5" y="3465.1997">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><polygon fill="#A80036" points="883.5,3495.3984,893.5,3499.3984,883.5,3503.3984,887.5,3499.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="557.5" x2="889.5" y1="3499.3984" y2="3499.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="564.5" y="3494.3325">APPR-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="622.5" y="3494.3325">approve()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="161" x="910" y="3512.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="914" y="3528.4653">state: approvalReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="947.5" y1="3561.6641" y2="3561.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="947.5" x2="947.5" y1="3561.6641" y2="3574.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="906.5" x2="947.5" y1="3574.6641" y2="3574.6641"/><polygon fill="#A80036" points="916.5,3570.6641,906.5,3574.6641,916.5,3578.6641,912.5,3574.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3556.5981">APPR-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="518" x="970.5" y="3556.5981">SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)</text><polygon fill="#A80036" points="2057,3599.7969,2067,3603.7969,2057,3607.7969,2061,3603.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="905.5" x2="2063" y1="3603.7969" y2="3603.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="912.5" y="3598.731">APPR-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="970.5" y="3598.731">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="911.5,3628.9297,901.5,3632.9297,911.5,3636.9297,907.5,3632.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="905.5" x2="2068" y1="3632.9297" y2="3632.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="917.5" y="3627.8638">APPR-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="975.5" y="3627.8638">202 Accepted</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="905" y="3645.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="909" y="3661.9966">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="2561,3691.1953,2571,3695.1953,2561,3699.1953,2565,3695.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="2567" y1="3695.1953" y2="3695.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2086" y="3690.1294">APPR-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="2144" y="3690.1294">PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="2085,3720.3281,2075,3724.3281,2085,3728.3281,2081,3724.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="2572" y1="3724.3281" y2="3724.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2091" y="3719.2622">APPR-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="2149" y="3719.2622">202 Accept</text><polygon fill="#A80036" points="3144,3749.4609,3154,3753.4609,3144,3757.4609,3148,3753.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2583" x2="3150" y1="3753.4609" y2="3753.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="2590" y="3748.395">APPR-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="496" x="2648" y="3748.395">notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}</text><polygon fill="#A80036" points="3971,3778.5938,3981,3782.5938,3971,3786.5938,3975,3782.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3977" y1="3782.5938" y2="3782.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="3168" y="3777.5278">APPR-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="3226" y="3777.5278">200: AuthorizationInformation</text><path d="M3828,3795.5938 L3828,3820.5938 L4144,3820.5938 L4144,3805.5938 L4134,3795.5938 L3828,3795.5938 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4134,3795.5938 L4134,3805.5938 L4144,3805.5938 L4134,3795.5938 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="3834" y="3812.6606">From now DFSPTransactionModel is unblocked</text><path d="M3766,3834.7266 L3766,3859.7266 L4205,3859.7266 L4205,3844.7266 L4195,3834.7266 L3766,3834.7266 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4195,3834.7266 L4195,3844.7266 L4205,3844.7266 L4195,3834.7266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="418" x="3772" y="3851.7935">DFSP checks the received AuthorizationInformation with backend.</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="221" x="3998" y="3873.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="4002" y="3889.9263">state: pendingVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="3923.125" y2="3923.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="3923.125" y2="3936.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="3936.125" y2="3936.125"/><polygon fill="#A80036" points="4004,3932.125,3994,3936.125,4004,3940.125,4000,3936.125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="3918.0591">APPR-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="439" x="4067" y="3918.0591">DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)</text><path d="M5,3949.125 L5,3974.125 L4059,3974.125 L4059,3959.125 L4049,3949.125 L5,3949.125 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4049,3949.125 L4049,3959.125 L4059,3959.125 L4049,3949.125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="609" x="1721" y="3966.1919">ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="279" x="3998" y="3988.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="4002" y="4004.3247">DFSP is unhappy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="4002" y="4019.4575">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4189" y="4019.4575">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="4203" y="4019.4575">REJECTED</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="209" x="3998" y="4036.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="4002" y="4052.5903">state: failureVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4085.7891" y2="4085.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4085.7891" y2="4098.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4098.7891" y2="4098.7891"/><polygon fill="#A80036" points="4004,4094.7891,3994,4098.7891,4004,4102.7891,4000,4098.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4080.7231">APPR-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="4067" y="4080.7231">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4127.9219" y2="4127.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4127.9219" y2="4140.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4140.9219" y2="4140.9219"/><polygon fill="#A80036" points="4004,4136.9219,3994,4140.9219,4004,4144.9219,4000,4140.9219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4122.856">APPR-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="512" x="4067" y="4122.856">SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)</text><polygon fill="#A80036" points="2090,4166.0547,2080,4170.0547,2090,4174.0547,2086,4170.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3982" y1="4170.0547" y2="4170.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2096" y="4164.9888">APPR-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="2163" y="4164.9888">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="3971,4195.1875,3981,4199.1875,3971,4203.1875,3975,4199.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2079" x2="3977" y1="4199.1875" y2="4199.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2086" y="4194.1216">APPR-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="2153" y="4194.1216">202 Accept</text><path d="M3742,4212.1875 L3742,4237.1875 L4229,4237.1875 L4229,4222.1875 L4219,4212.1875 L3742,4212.1875 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4219,4212.1875 L4219,4222.1875 L4229,4222.1875 L4219,4212.1875 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="3748" y="4229.2544">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="343" x="3871" y="4229.2544">DFSPTransactionModel ends its workflow here</text><polygon fill="#A80036" points="1516.5,4263.4531,1506.5,4267.4531,1516.5,4271.4531,1512.5,4267.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="4819" y1="4267.4531" y2="4267.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1522.5" y="4262.3872">APPR-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="1589.5" y="4262.3872">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="2062,4292.5859,2072,4296.5859,2062,4300.5859,2066,4296.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1505.5" x2="2068" y1="4296.5859" y2="4296.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1512.5" y="4291.52">APPR-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="1579.5" y="4291.52">202 Accept</text><path d="M647,4309.5859 L647,4334.5859 L1149,4334.5859 L1149,4319.5859 L1139,4309.5859 L647,4309.5859 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1139,4309.5859 L1139,4319.5859 L1149,4319.5859 L1139,4309.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="653" y="4326.6528">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="358" x="776" y="4326.6528">PISPTransactionModel will end its workflow here</text><polygon fill="#A80036" points="916.5,4360.8516,906.5,4364.8516,916.5,4368.8516,912.5,4364.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1499.5" y1="4364.8516" y2="4364.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="4359.7856">APPR-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="989.5" y="4359.7856">authorizationRejected()</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="186" x="910" y="4377.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="914" y="4393.9185">state: rejectedAuthorization</text><polygon fill="#A80036" points="568.5,4423.1172,558.5,4427.1172,568.5,4431.1172,564.5,4427.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="4427.1172" y2="4427.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="4422.0513">APPR-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="641.5" y="4422.0513">not approved: authorization is rejected</text><polygon fill="#A80036" points="90.5,4452.25,80.5,4456.25,90.5,4460.25,86.5,4456.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="84.5" x2="546.5" y1="4456.25" y2="4456.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="96.5" y="4451.1841">APPR-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="163.5" y="4451.1841">500: authorization is rejected</text><path d="M5,4469.25 L5,4494.25 L4059,4494.25 L4059,4479.25 L4049,4469.25 L5,4469.25 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4049,4469.25 L4049,4479.25 L4059,4479.25 L4049,4469.25 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="1805.5" y="4486.3169">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="317" x="1928.5" y="4486.3169">DFSPTransactionModel continues workflow</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="286" x="3998" y="4508.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="4002" y="4524.4497">DFSP is happy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="4002" y="4539.5825">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="4189" y="4539.5825">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="4203" y="4539.5825">ACCEPTED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4572.7813" y2="4572.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4572.7813" y2="4585.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4585.7813" y2="4585.7813"/><polygon fill="#A80036" points="4004,4581.7813,3994,4585.7813,4004,4589.7813,4000,4585.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4567.7153">APPR-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="4067" y="4567.7153">persist transactionRequestState for transactionRequestId</text><path d="M3808,4598.7813 L3808,4623.7813 L4164,4623.7813 L4164,4608.7813 L4154,4598.7813 L3808,4598.7813 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4154,4598.7813 L4154,4608.7813 L4164,4608.7813 L4154,4598.7813 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="3814" y="4615.8481">DFSP is happy, so initiates the Transfer for transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4654.0469" y2="4654.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4654.0469" y2="4667.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4667.0469" y2="4667.0469"/><polygon fill="#A80036" points="4004,4663.0469,3994,4667.0469,4004,4671.0469,4000,4667.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4648.981">APPR-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="4067" y="4648.981">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="73" x="4129" y="4648.981">transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4696.1797" y2="4696.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4696.1797" y2="4709.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4709.1797" y2="4709.1797"/><polygon fill="#A80036" points="4004,4705.1797,3994,4709.1797,4004,4713.1797,4000,4709.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4691.1138">APPR-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="4067" y="4691.1138">transfer(transferId)</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="152" x="3998" y="4722.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="4002" y="4738.2466">state: pendingTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4771.4453" y2="4771.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4771.4453" y2="4784.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4784.4453" y2="4784.4453"/><polygon fill="#A80036" points="4004,4780.4453,3994,4784.4453,4004,4788.4453,4000,4784.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4766.3794">APPR-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="4067" y="4766.3794">SDKRequests.requestTransfer(transferId, transferPayload)</text><polygon fill="#A80036" points="3177,4809.5781,3167,4813.5781,3177,4817.5781,3173,4813.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3171" x2="3982" y1="4813.5781" y2="4813.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3183" y="4808.5122">APPR-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3250" y="4808.5122">SYNC POST /simpleTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3166" x2="3208" y1="4842.7109" y2="4842.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3208" x2="3208" y1="4842.7109" y2="4855.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3167" x2="3208" y1="4855.7109" y2="4855.7109"/><polygon fill="#A80036" points="3177,4851.7109,3167,4855.7109,3177,4859.7109,3173,4855.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3173" y="4837.645">APPR-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="3240" y="4837.645">request Switch to realize simple transfer</text><polygon fill="#A80036" points="3971,4880.8438,3981,4884.8438,3971,4888.8438,3975,4884.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3161" x2="3977" y1="4884.8438" y2="4884.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="3168" y="4879.7778">APPR-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="3235" y="4879.7778">202: Transfer done</text><path d="M3849,4897.8438 L3849,4922.8438 L4122,4922.8438 L4122,4907.8438 L4112,4897.8438 L3849,4897.8438 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4112,4897.8438 L4112,4907.8438 L4122,4907.8438 L4112,4897.8438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="3855" y="4914.9106">DFSP notifies PISP that Transfer is done</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3993" x2="4035" y1="4953.1094" y2="4953.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4035" x2="4035" y1="4953.1094" y2="4966.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3994" x2="4035" y1="4966.1094" y2="4966.1094"/><polygon fill="#A80036" points="4004,4962.1094,3994,4966.1094,4004,4970.1094,4000,4966.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="4000" y="4948.0435">APPR-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="4067" y="4948.0435">SDKRequests.notifyThirdpartyAboutTransfer(transferId)</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="291" x="3998" y="4979.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="4002" y="4995.1763">state: pendingNotifyThirdpartyAboutTransfer</text><polygon fill="#A80036" points="2090,5024.375,2080,5028.375,2090,5032.375,2086,5028.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2084" x2="3982" y1="5028.375" y2="5028.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2096" y="5023.3091">APPR-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="2163" y="5023.3091">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="3976,5053.5078,3986,5057.5078,3976,5061.5078,3980,5057.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2079" x2="3982" y1="5057.5078" y2="5057.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="2086" y="5052.4419">APPR-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2153" y="5052.4419">202 Accepted</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="226" x="3993" y="5070.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="3997" y="5086.5747">state: transactionRequestSuccess</text><path d="M671,5103.6406 L671,5128.6406 L1126,5128.6406 L1126,5113.6406 L1116,5103.6406 L671,5103.6406 " fill="#FBFB77" filter="url(#fan616bmhsmwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1116,5103.6406 L1116,5113.6406 L1126,5113.6406 L1116,5103.6406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="677" y="5120.7075">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="311" x="800" y="5120.7075">PISPTransactionModel continues workflow</text><polygon fill="#A80036" points="1516.5,5154.9063,1506.5,5158.9063,1516.5,5162.9063,1512.5,5158.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1510.5" x2="2068" y1="5158.9063" y2="5158.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1522.5" y="5153.8403">APPR-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="410" x="1589.5" y="5153.8403">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="2062,5184.0391,2072,5188.0391,2062,5192.0391,2066,5188.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1505.5" x2="2068" y1="5188.0391" y2="5188.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1512.5" y="5182.9731">APPR-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1579.5" y="5182.9731">200 OK</text><polygon fill="#A80036" points="916.5,5213.1719,906.5,5217.1719,916.5,5221.1719,912.5,5217.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="910.5" x2="1499.5" y1="5217.1719" y2="5217.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="922.5" y="5212.106">APPR-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="989.5" y="5212.106">transactionSuccess(transactionRequestId)</text><rect fill="#FBFB77" filter="url(#fan616bmhsmwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="174" x="910" y="5230.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="914" y="5246.2388">state: transactionSuccess</text><polygon fill="#A80036" points="568.5,5275.4375,558.5,5279.4375,568.5,5283.4375,564.5,5279.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="562.5" x2="899.5" y1="5279.4375" y2="5279.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="574.5" y="5274.3716">APPR-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="641.5" y="5274.3716">Transaction &amp; Transfer are done</text><polygon fill="#A80036" points="85.5,5304.5703,75.5,5308.5703,85.5,5312.5703,81.5,5308.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79.5" x2="551.5" y1="5308.5703" y2="5308.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="91.5" y="5303.5044">APPR-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="158.5" y="5303.5044">200 OK</text><!--MD5=[d7ad665951b75fd92f766287aab09e90]
@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
' TODO: line up with state-models.md doc
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

' TODO: party lookup details
PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization(QuoteInformation)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /thirdpartyRequests/authorizations
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
Switch - -> DFSP_SDK_OUT: 202 Accepted
DFSP_SDK_OUT -> DFSP_SDK_OUT: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate DFSP_SDK_OUT
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

'TODO: add authorization details
PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accept
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP checks the received AuthorizationInformation with backend.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransaction/partyLookup
{
  transactionRequestId: "b51ec534-ee48-4575-b6a9-ead2955b8069",
  payee: {
    partyIdType: "MSISDN",
    partyIdentifier: "+123456789"
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransaction/partyLookup
activate PISP
activate PISP_TP_OUT
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequests.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequests.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: DFSPBackendRequests.validateThirdpartyTransactionRequestAndGetContext(transactionRequest)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /thirdpartyRequests/authorizations**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.requestAuthorization(QuoteInformation)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /thirdpartyRequests/authorizations
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /thirdpartyRequests/authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> Switch: POST /thirdpartyRequests/authorizations
activate Switch
Switch - -> DFSP_SDK_OUT: 202 Accepted
DFSP_SDK_OUT -> DFSP_SDK_OUT: waiting on PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
deactivate DFSP_SDK_OUT
Switch -> PISP_TP_IN: POST /thirdpartyRequests/authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequests.requestVerifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accept
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /thirdpartyRequests/authorizations/{authorizationRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP checks the received AuthorizationInformation with backend.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: DFSPBackendRequests.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequests.requestTransfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequests.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.7(Sun May 23 22:10:07 ACST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>